<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</title>
    <style>
        body { 
            font-family: Arial; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            max-width: 500px;
            margin: 50px auto;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        h1 { color: #F1C40F; }
        input {
            width: 80%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn:hover { background: #45a049; }
        .btn-blue { background: #2196F3; }
        .btn-blue:hover { background: #1976D2; }
        .wechat {
            background: #07C160;
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            margin: 20px 0;
            display: inline-block;
            font-weight: bold;
        }
        /* é”™è¯¯ä¿¡æ¯æ ·å¼ */
        .error {
            color: red;
            background: #FFEBEE;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</h1>
        <h2>å¿«æ¥èƒŒå•è¯ï¼</h2>
        
        <!-- é”™è¯¯ä¿¡æ¯ -->
        <div id="error-message" class="error"></div>
        
        <div id="login-screen">
            <h3>ç”¨æˆ·ç™»å½• / æ³¨å†Œ</h3>
            <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autofocus>
            
            <div>
                <button class="btn" onclick="handleLogin()">ç™»å½•</button>
                <button class="btn btn-blue" onclick="handleRegister()">æ–°ç”¨æˆ·æ³¨å†Œ</button>
            </div>
            
            <div class="wechat">
                ğŸ’¬ å¾®ä¿¡è”ç³»ï¼š<strong>Kathy151</strong>
            </div>
            
            <p style="color: #666; margin-top: 20px; font-size: 14px;">
                å­¦ç”Ÿè¯·æ³¨å†Œæ–°ç”¨æˆ·ï¼Œæ•™å¸ˆè¯·ä½¿ç”¨è´¦å·ï¼škathy151
            </p>
        </div>
        
        <div id="menu-screen" style="display:none;">
            <h2 id="welcome">æ¬¢è¿</h2>
            <div id="user-info"></div>
            
            <div style="margin: 30px 0;">
                <button class="btn" onclick="startTraining()">ğŸ¯ å¼€å§‹è®­ç»ƒ</button>
                <button class="btn btn-blue" onclick="addWords()">ğŸ“ æ·»åŠ å•è¯</button>
                <button class="btn" onclick="viewWords()">ğŸ“– æˆ‘çš„å•è¯</button>
                <button class="btn" onclick="logout()">ğŸšª é€€å‡º</button>
            </div>
            
            <!-- å•è¯åˆ—è¡¨ -->
            <div id="word-list" style="display:none; margin-top: 20px;">
                <h3>æˆ‘çš„å•è¯åº“</h3>
                <div id="words-container"></div>
            </div>
        </div>
        
        <!-- æ·»åŠ å•è¯ç•Œé¢ -->
        <div id="add-screen" style="display:none;">
            <h3>ğŸ“ æ·»åŠ å•è¯</h3>
            <textarea id="word-input" placeholder="è¾“å…¥å•è¯ï¼Œæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šè‹±æ–‡ ä¸­æ–‡&#10;ä¾‹å¦‚ï¼š&#10;hello ä½ å¥½&#10;apple è‹¹æœ" 
                     style="width: 90%; height: 150px; padding: 10px; margin: 15px 0;"></textarea>
            <div>
                <button class="btn" onclick="importWords()">æ·»åŠ å•è¯</button>
                <button class="btn" onclick="showMenu()">è¿”å›</button>
            </div>
        </div>
    </div>

    <script>
        // ç”¨æˆ·æ•°æ®
        let currentUser = null;
        let isTeacher = false;
        let userWords = [];
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }
        
        // åˆ‡æ¢ç•Œé¢æ˜¾ç¤º
        function showScreen(screenId) {
            console.log('åˆ‡æ¢åˆ°ç•Œé¢:', screenId);
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('add-screen').style.display = 'none';
            document.getElementById('word-list').style.display = 'none';
            
            document.getElementById(screenId).style.display = 'block';
        }
        
        function showMenu() {
            showScreen('menu-screen');
            updateUserInfo();
        }
        
        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        function updateUserInfo() {
            if (isTeacher) {
                document.getElementById('user-info').innerHTML = `
                    <p style="color: #9C27B0; font-weight: bold;">ğŸ‘‘ æ•™å¸ˆç®¡ç†é¢æ¿</p>
                    <p>å¾®ä¿¡ï¼šKathy151</p>
                `;
            } else {
                const wordCount = userWords.length;
                const remembered = userWords.filter(w => w.status === 'remembered').length;
                
                document.getElementById('user-info').innerHTML = `
                    <p>ğŸ“Š å­¦ä¹ ç»Ÿè®¡ï¼š</p>
                    <p>å•è¯æ€»æ•°ï¼š${wordCount} ä¸ª</p>
                    <p>å·²æŒæ¡ï¼š${remembered} ä¸ª</p>
                `;
            }
        }
        
        // ç™»å½•åŠŸèƒ½
        function handleLogin() {
            console.log("=== ç™»å½•åŠŸèƒ½å¼€å§‹ ===");
            const username = document.getElementById('username').value.trim();
            console.log("è¾“å…¥çš„ç”¨æˆ·å:", username);
            
            if (!username) {
                showError('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }
            
            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦åˆæ³•
            if (username.length < 2) {
                showError('ç”¨æˆ·åè‡³å°‘2ä¸ªå­—ç¬¦');
                return;
            }
            
            currentUser = username;
            isTeacher = (username === 'kathy151');
            
            if (isTeacher) {
                console.log("æ£€æµ‹åˆ°æ•™å¸ˆè´¦å·");
                // æ•™å¸ˆç™»å½•
                userWords = [];
            } else {
                console.log("æ£€æµ‹åˆ°å­¦ç”Ÿè´¦å·");
                // å­¦ç”Ÿç™»å½• - ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
                const savedData = localStorage.getItem(`word_user_${username}`);
                if (savedData) {
                    userWords = JSON.parse(savedData);
                    console.log("åŠ è½½åˆ°ç”¨æˆ·æ•°æ®ï¼Œå•è¯æ•°:", userWords.length);
                } else {
                    // å¦‚æœæ˜¯æ–°ç”¨æˆ·ï¼Œè¦æ±‚æ³¨å†Œ
                    if (confirm(`ç”¨æˆ·"${username}"ä¸å­˜åœ¨ï¼Œæ˜¯å¦æ³¨å†Œä¸ºæ–°ç”¨æˆ·ï¼Ÿ`)) {
                        handleRegister();
                        return;
                    } else {
                        currentUser = null;
                        return;
                    }
                }
            }
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            document.getElementById('welcome').textContent = 
                isTeacher ? 'ğŸ‘‘ æ¬¢è¿Kathyè€å¸ˆï¼' : `ğŸ“ æ¬¢è¿ ${username}ï¼`;
            
            // ä¿å­˜ç™»å½•çŠ¶æ€
            localStorage.setItem('current_user', username);
            
            showMenu();
            console.log("ç™»å½•æˆåŠŸï¼Œåˆ‡æ¢åˆ°èœå•");
        }
        
        // æ³¨å†ŒåŠŸèƒ½
        function handleRegister() {
            console.log("=== æ³¨å†ŒåŠŸèƒ½å¼€å§‹ ===");
            const username = document.getElementById('username').value.trim();
            console.log("æ³¨å†Œç”¨æˆ·å:", username);
            
            if (!username) {
                showError('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }
            
            if (username.length < 2) {
                showError('ç”¨æˆ·åè‡³å°‘2ä¸ªå­—ç¬¦');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const savedData = localStorage.getItem(`word_user_${username}`);
            if (savedData) {
                showError('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·ç›´æ¥ç™»å½•');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ•™å¸ˆç”¨æˆ·å
            if (username.toLowerCase() === 'kathy151') {
                showError('è¯¥ç”¨æˆ·åä¸å¯ç”¨');
                return;
            }
            
            // åˆ›å»ºæ–°ç”¨æˆ·
            currentUser = username;
            isTeacher = false;
            userWords = []; // åˆå§‹ä¸ºç©º
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem(`word_user_${username}`, JSON.stringify([]));
            localStorage.setItem('current_user', username);
            
            console.log("æ–°ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼Œç”¨æˆ·å:", username);
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            document.getElementById('welcome').textContent = `ğŸ“ æ¬¢è¿ ${username}ï¼`;
            
            showMenu();
            alert(`âœ… æ¬¢è¿ ${username} åŠ å…¥Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥ï¼\n\nå¼€å§‹ä½ çš„å•è¯å­¦ä¹ ä¹‹æ—…å§ï¼`);
        }
        
        // å•è¯è®­ç»ƒ
        function startTraining() {
            if (userWords.length === 0) {
                alert('è¯·å…ˆæ·»åŠ å•è¯ï¼Œç„¶åå¼€å§‹è®­ç»ƒ');
                return;
            }
            
            alert(`å¼€å§‹è®­ç»ƒ ${userWords.length} ä¸ªå•è¯`);
            // è¿™é‡Œå¯ä»¥æ·»åŠ è®­ç»ƒé€»è¾‘
        }
        
        // æ·»åŠ å•è¯
        function addWords() {
            showScreen('add-screen');
        }
        
        // å¯¼å…¥å•è¯
        function importWords() {
            const input = document.getElementById('word-input').value.trim();
            
            if (!input) {
                alert('è¯·è¾“å…¥å•è¯');
                return;
            }
            
            const lines = input.split('\n');
            let added = 0;
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;
                
                // ç®€å•è§£æï¼šè‹±æ–‡å’Œä¸­æ–‡ç”¨ç©ºæ ¼åˆ†éš”
                const parts = trimmed.split(/\s+/);
                if (parts.length >= 2) {
                    const english = parts[0];
                    const chinese = parts.slice(1).join(' ');
                    
                    // æ£€æŸ¥æ˜¯å¦é‡å¤
                    const exists = userWords.some(w => 
                        w.english.toLowerCase() === english.toLowerCase());
                    
                    if (!exists) {
                        userWords.push({
                            english: english,
                            chinese: chinese,
                            status: '', // æœªå­¦ä¹ 
                            reviewCount: 0
                        });
                        added++;
                    }
                }
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            if (currentUser && !isTeacher) {
                localStorage.setItem(`word_user_${currentUser}`, JSON.stringify(userWords));
            }
            
            alert(`âœ… æˆåŠŸæ·»åŠ  ${added} ä¸ªæ–°å•è¯\nå½“å‰å•è¯æ€»æ•°ï¼š${userWords.length}`);
            document.getElementById('word-input').value = '';
            showMenu();
        }
        
        // æŸ¥çœ‹å•è¯
        function viewWords() {
            if (userWords.length === 0) {
                document.getElementById('words-container').innerHTML = 
                    '<p>è¿˜æ²¡æœ‰å•è¯ï¼Œå¿«å»æ·»åŠ å§ï¼</p>';
            } else {
                let html = '<div style="text-align: left; max-height: 300px; overflow-y: auto;">';
                userWords.forEach((word, index) => {
                    const status = word.status === 'remembered' ? 'âœ…' : 
                                  word.status === 'fuzzy' ? 'ğŸ”„' : 'âŒ';
                    html += `
                        <div style="padding: 10px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">
                            <strong>${word.english}</strong> - ${word.chinese}
                            <span style="float: right;">${status}</span>
                        </div>
                    `;
                });
                html += '</div>';
                document.getElementById('words-container').innerHTML = html;
            }
            
            document.getElementById('word-list').style.display = 'block';
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                currentUser = null;
                isTeacher = false;
                userWords = [];
                localStorage.removeItem('current_user');
                document.getElementById('username').value = '';
                showScreen('login-screen');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
        window.addEventListener('load', function() {
            console.log("é¡µé¢åŠ è½½å®Œæˆ");
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„ç”¨æˆ·
            const savedUser = localStorage.getItem('current_user');
            if (savedUser) {
                currentUser = savedUser;
                isTeacher = (savedUser === 'kathy151');
                
                // åŠ è½½ç”¨æˆ·æ•°æ®
                if (!isTeacher) {
                    const savedData = localStorage.getItem(`word_user_${savedUser}`);
                    if (savedData) {
                        userWords = JSON.parse(savedData);
                    }
                }
                
                document.getElementById('welcome').textContent = 
                    isTeacher ? 'ğŸ‘‘ æ¬¢è¿Kathyè€å¸ˆï¼' : `ğŸ“ æ¬¢è¿ ${savedUser}ï¼`;
                document.getElementById('username').value = savedUser;
                showMenu();
            }
            
            // ç»‘å®šå›è½¦é”®
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    console.log("å›è½¦é”®è¢«æŒ‰ä¸‹");
                    handleLogin();
                }
            });
        });
    </script>
</body>
</html>
