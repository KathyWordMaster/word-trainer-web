<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥ - æµ‹è¯•ç‰ˆï¼ˆçŸ­è¯­+å‘éŸ³ï¼‰</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
        }
        
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2C3E50 0%, #4A6491 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            color: #F1C40F;
        }
        
        .main-content {
            padding: 30px;
        }
        
        /* é¡µé¢åˆ‡æ¢ */
        .screen {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .screen.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 14px 28px;
            margin: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-blue { background: #2196F3; }
        .btn-blue:hover { background: #1976D2; }
        
        .btn-red { background: #F44336; }
        .btn-red:hover { background: #D32F2F; }
        
        .btn-purple { background: #9C27B0; }
        .btn-purple:hover { background: #7B1FA2; }
        
        .btn-gold { background: #FFC107; color: #333; }
        .btn-gold:hover { background: #FFA000; }
        
        /* è¾“å…¥æ¡† */
        input[type="text"], textarea {
            width: 100%;
            max-width: 400px;
            padding: 16px;
            margin: 12px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        textarea {
            height: 200px;
            font-family: monospace;
            resize: vertical;
        }
        
        /* å•è¯å¡ç‰‡ */
        .word-card {
            background: white;
            border: 4px solid #4CAF50;
            border-radius: 20px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            cursor: pointer;
            font-size: 2.8em;
            font-weight: bold;
            transition: all 0.3s;
            max-width: 600px;
            position: relative;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .word-card.flipped {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            border-color: #2E7D32;
        }
        
        /* å‘éŸ³æŒ‰é’®æ ·å¼ */
        .speak-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            color: #2196F3;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .speak-btn:hover {
            background: #E3F2FD;
            transform: scale(1.1);
        }
        
        .speak-btn.speaking {
            color: #F44336;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #4CAF50;
        }
        
        /* è¡¨æ ¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .data-table th {
            background: #4CAF50;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        /* å¾®ä¿¡è”ç³» */
        .wechat-badge {
            background: #07C160;
            color: white;
            padding: 14px 28px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: bold;
            font-size: 1.1em;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(7, 193, 96, 0.3);
        }
        
        /* å‘éŸ³è®¾ç½® */
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #4CAF50;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .word-card {
                height: 220px;
                font-size: 2.2em;
                margin: 20px 10px;
            }
            
            .btn {
                padding: 12px 20px;
                margin: 8px;
                font-size: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</h1>
            <h2 style="color: white;">æµ‹è¯•ç‰ˆ - çŸ­è¯­+å‘éŸ³åŠŸèƒ½</h2>
            <p style="color: #BDC3C7; font-size: 0.9em;">ğŸ‘‘ æ•™å¸ˆï¼šKathy | ğŸ’¬ å¾®ä¿¡ï¼šKathy151</p>
        </div>
        
        <div class="main-content">
            <!-- ========== ç™»å½•ç•Œé¢ ========== -->
            <div id="login-screen" class="screen active">
                <div style="text-align: center;">
                    <h2>ğŸ‘‘ æ•™å¸ˆç›‘æ§ç³»ç»Ÿç™»å½•</h2>
                    <p style="color: #666; margin-bottom: 30px;">æµ‹è¯•è´¦å·ï¼šå­¦ç”Ÿè¯·ä½¿ç”¨ä»»æ„ç”¨æˆ·åæ³¨å†Œ</p>
                    
                    <div style="margin: 30px 0;">
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autofocus>
                        
                        <div style="margin: 25px 0;">
                            <button class="btn" onclick="login()">
                                <span>ğŸ”‘ ç™»å½•</span>
                            </button>
                            <button class="btn btn-blue" onclick="register()">
                                <span>ğŸ“ å­¦ç”Ÿæ³¨å†Œ</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- è”ç³»ä¿¡æ¯ -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 30px 0;">
                        <h3 style="color: #2C3E50; margin-bottom: 20px;">ğŸ’¬ è”ç³»ä¿¡æ¯</h3>
                        <div class="wechat-badge">
                            <span>æ•™å¸ˆå¾®ä¿¡ï¼š</span>
                            <strong>Kathy151</strong>
                        </div>
                        <p style="color: #555; margin-top: 15px; font-size: 0.95em;">
                            å­¦ç”Ÿè¯·æ³¨å†Œæ–°è´¦å·ï¼Œæ•™å¸ˆè´¦å·ï¼škathy151
                        </p>
                    </div>
                    
                    <!-- æµ‹è¯•è¯´æ˜ -->
                    <div style="background: #FFF3E0; border-radius: 15px; padding: 25px; margin: 30px 0;">
                        <h3 style="color: #FF9800; margin-bottom: 15px;">ğŸ§ª æµ‹è¯•è¯´æ˜</h3>
                        <p style="color: #666; margin-bottom: 10px;">âœ… <strong>çŸ­è¯­åŠŸèƒ½æµ‹è¯•</strong>ï¼šæ³¨å†Œåå°è¯•å¯¼å…¥çŸ­è¯­</p>
                        <p style="color: #666; margin-bottom: 10px;">âœ… <strong>å‘éŸ³åŠŸèƒ½æµ‹è¯•</strong>ï¼šåœ¨è®­ç»ƒç•Œé¢æµ‹è¯•å•è¯å‘éŸ³</p>
                        <p style="color: #666;">ğŸ”Š <strong>å‘éŸ³è¦æ±‚</strong>ï¼šéœ€è¦æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½</p>
                    </div>
                </div>
            </div>
            
            <!-- ========== ä¸»èœå•ï¼ˆå­¦ç”Ÿï¼‰ ========== -->
            <div id="student-menu" class="screen">
                <h2 id="student-welcome" style="text-align: center; margin-bottom: 30px;"></h2>
                
                <!-- å­¦ä¹ ç»Ÿè®¡ -->
                <div class="stats-card">
                    <h3 style="color: #2196F3; margin-bottom: 20px;">ğŸ“Š æˆ‘çš„å­¦ä¹ è¿›åº¦</h3>
                    <div id="student-stats">
                        <p>æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...</p>
                    </div>
                </div>
                
                <!-- å¿«é€Ÿæ“ä½œ -->
                <div style="text-align: center; margin: 30px 0;">
                    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 20px;">
                        <button class="btn" onclick="showAddWords()">
                            <span>ğŸ“ æ·»åŠ å•è¯/çŸ­è¯­</span>
                        </button>
                        <button class="btn btn-blue" onclick="startTraining()">
                            <span>ğŸ¯ å¼€å§‹è®­ç»ƒ</span>
                        </button>
                        <button class="btn" onclick="showMyWords()">
                            <span>ğŸ“– æˆ‘çš„å•è¯åº“</span>
                        </button>
                        <button class="btn btn-gold" onclick="showReviewWords()">
                            <span>ğŸ”„ å¤ä¹ å¼±é¡¹</span>
                        </button>
                        <button class="btn btn-purple" onclick="showSettings()">
                            <span>âš™ï¸ å‘éŸ³è®¾ç½®</span>
                        </button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-red" onclick="logout()">
                            <span>ğŸšª é€€å‡ºç™»å½•</span>
                        </button>
                    </div>
                </div>
                
                <!-- æµ‹è¯•æç¤º -->
                <div style="text-align: center; margin-top: 40px; padding: 15px; background: #E8F5E9; border-radius: 10px;">
                    <p style="color: #2E7D32; margin: 0;">
                        ğŸ§ª <strong>æµ‹è¯•æç¤º</strong>ï¼šå…ˆæ·»åŠ å•è¯/çŸ­è¯­ï¼Œç„¶åå¼€å§‹è®­ç»ƒæµ‹è¯•å‘éŸ³åŠŸèƒ½
                    </p>
                </div>
            </div>
            
            <!-- ========== æ‰¹é‡æ·»åŠ å•è¯ ========== -->
            <div id="add-words-screen" class="screen">
                <div style="max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“ æ‰¹é‡æ·»åŠ å•è¯/çŸ­è¯­</h2>
                    
                    <div style="background: #E3F2FD; border-radius: 10px; padding: 20px; margin-bottom: 25px;">
                        <p><strong>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</strong></p>
                        <p>æ¯è¡Œä¸€ä¸ªå•è¯æˆ–çŸ­è¯­ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼š</p>
                        <p><strong>ç®€å•å•è¯ï¼š</strong> hello ä½ å¥½ æˆ– apple:è‹¹æœ æˆ– world=ä¸–ç•Œ</p>
                        <p><strong>çŸ­è¯­ï¼ˆæ¨èç”¨å¼•å·ï¼‰ï¼š</strong> "good morning" æ—©ä¸Šå¥½ æˆ– 'how are you' = ä½ å¥½å—</p>
                        <p><strong>ä¸­æ–‡çŸ­è¯­ï¼š</strong> "æ—©ä¸Šå¥½" good morning</p>
                        <p><strong>åˆ†éš”ç¬¦ï¼š</strong> ç©ºæ ¼ã€å†’å·(:)ã€ç­‰å·(=)ã€é€—å·(,)ã€ä¸­æ–‡å†’å·(ï¼š)ã€ä¸­æ–‡é€—å·(ï¼Œ)</p>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <textarea id="word-input" placeholder="åœ¨è¿™é‡Œç²˜è´´æˆ–è¾“å…¥å•è¯å’ŒçŸ­è¯­...
æµ‹è¯•ç¤ºä¾‹ï¼š
hello ä½ å¥½
"good morning" æ—©ä¸Šå¥½
'how are you' = ä½ å¥½å—
apple:è‹¹æœ
"thank you" è°¢è°¢ä½ 
computer ç”µè„‘
"æ—©ä¸Šå¥½" good morning</textarea>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="btn" onclick="importWords()">
                            <span>ğŸ“¥ å¯¼å…¥å•è¯/çŸ­è¯­</span>
                        </button>
                        <button class="btn btn-blue" onclick="pasteFromClipboard()">
                            <span>ğŸ“‹ ç²˜è´´å†…å®¹</span>
                        </button>
                        <button class="btn" onclick="loadExampleWords()">
                            <span>ğŸ“š åŠ è½½æµ‹è¯•ç¤ºä¾‹</span>
                        </button>
                        <button class="btn btn-red" onclick="showStudentMenu()">
                            <span>ğŸ”™ è¿”å›</span>
                        </button>
                    </div>
                    
                    <!-- å¯¼å…¥ç»“æœ -->
                    <div id="import-result" style="display: none; padding: 15px; background: #e8f5e8; border-radius: 8px; margin-top: 20px;"></div>
                </div>
            </div>
            
            <!-- ========== å•è¯è®­ç»ƒç•Œé¢ ========== -->
            <div id="train-screen" class="screen">
                <div style="text-align: center;">
                    <h2 style="margin-bottom: 10px;">ğŸ¯ å•è¯è®­ç»ƒï¼ˆæµ‹è¯•å‘éŸ³åŠŸèƒ½ï¼‰</h2>
                    <p style="color: #666; margin-bottom: 25px;">ç‚¹å‡»å¡ç‰‡ç¿»è½¬ï¼Œç‚¹å‡»ğŸ”ŠæŒ‰é’®æµ‹è¯•å‘éŸ³</p>
                    
                    <!-- è®­ç»ƒæ§åˆ¶ -->
                    <div style="margin-bottom: 30px;">
                        <div class="progress-container">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span id="progress-text" style="color: #666;">è¿›åº¦: 0/0</span>
                                <span id="mode-text" style="color: #2196F3; font-weight: bold;">è‹±æ–‡ â†’ ä¸­æ–‡</span>
                            </div>
                            <div class="progress-bar">
                                <div id="train-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <button class="btn btn-gold" onclick="toggleTrainingMode()" style="padding: 10px 20px; font-size: 14px;">
                                <span>ğŸ”„ åˆ‡æ¢è®­ç»ƒæ¨¡å¼</span>
                            </button>
                            <button class="btn" onclick="shuffleWords()" style="padding: 10px 20px; font-size: 14px;">
                                <span>ğŸ² é‡æ–°æ´—ç‰Œ</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- å•è¯å¡ç‰‡ï¼ˆå¸¦å‘éŸ³æŒ‰é’®ï¼‰ -->
                    <div id="word-card" class="word-card" onclick="handleCardClick()">
                        <div id="card-content" style="position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div id="card-front" class="card-front" style="font-size: 2.8em; font-weight: bold; text-align: center; padding: 20px;">
                                ç‚¹å‡»å¼€å§‹è®­ç»ƒ
                            </div>
                            <div id="card-back" class="card-back" style="display:none; color:#2E7D32; font-size: 2em; font-weight: bold; text-align: center; padding: 20px;">
                            </div>
                            <button id="speak-button" class="speak-btn" onclick="speakCurrentWord(event)" style="position: absolute; bottom: 15px; right: 15px; background: rgba(255,255,255,0.8);">
                                ğŸ”Š
                            </button>
                        </div>
                    </div>
                    
                    <!-- è®°å¿†æŒ‰é’® -->
                    <div style="margin: 35px 0;">
                        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;">
                            <button class="btn" onclick="markWord('remembered')" style="padding: 16px 32px; font-size: 17px;">
                                <span>âœ… è®°å¾—</span>
                            </button>
                            <button class="btn btn-blue" onclick="markWord('fuzzy')" style="padding: 16px 32px; font-size: 17px;">
                                <span>ğŸ”„ æ¨¡ç³Š</span>
                            </button>
                            <button class="btn btn-red" onclick="markWord('forgot')" style="padding: 16px 32px; font-size: 17px;">
                                <span>âŒ å¿˜è®°</span>
                            </button>
                            <button class="btn" onclick="skipWord()" style="padding: 16px 32px; font-size: 17px;">
                                <span>â­ï¸ è·³è¿‡</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- å‘éŸ³æµ‹è¯•æç¤º -->
                    <div style="background: #FFF3E0; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 600px;">
                        <p style="color: #FF9800; font-weight: bold; margin-bottom: 10px;">ğŸ”Š å‘éŸ³æµ‹è¯•æç¤ºï¼š</p>
                        <p style="color: #666; font-size: 0.9em;">1. ç‚¹å‡»å–‡å­æŒ‰é’®æµ‹è¯•å½“å‰å•è¯å‘éŸ³</p>
                        <p style="color: #666; font-size: 0.9em;">2. å¦‚æœå‘éŸ³ä¸å·¥ä½œï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™</p>
                        <p style="color: #666; font-size: 0.9em;">3. æ”¯æŒä¸­è‹±æ–‡å•è¯å’ŒçŸ­è¯­å‘éŸ³</p>
                    </div>
                    
                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div style="margin-top: 30px;">
                        <button class="btn btn-red" onclick="endTraining()">
                            <span>ğŸ ç»“æŸè®­ç»ƒ</span>
                        </button>
                        <button class="btn" onclick="showStudentMenu()">
                            <span>ğŸ“‹ è¿”å›èœå•</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ========== è®¾ç½®ç•Œé¢ ========== -->
            <div id="settings-screen" class="screen">
                <div style="max-width: 700px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 30px;">âš™ï¸ å‘éŸ³è®¾ç½®</h2>
                    
                    <!-- å‘éŸ³è®¾ç½® -->
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                        <h3 style="color: #333; margin-bottom: 20px;">ğŸ”Š å‘éŸ³è®¾ç½®</h3>
                        
                        <div class="setting-item">
                            <div>
                                <strong>è‡ªåŠ¨å‘éŸ³</strong>
                                <p style="color: #666; font-size: 0.9em; margin-top: 5px;">åœ¨è®­ç»ƒæ—¶è‡ªåŠ¨æœ—è¯»å•è¯</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="auto-speak" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div>
                                <strong>è®­ç»ƒæ¨¡å¼å‘éŸ³</strong>
                                <p style="color: #666; font-size: 0.9em; margin-top: 5px;">åˆ‡æ¢è®­ç»ƒæ¨¡å¼æ—¶é‡æ–°å‘éŸ³</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="mode-speak" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div>
                                <strong>ç‚¹å‡»å¡ç‰‡å‘éŸ³</strong>
                                <p style="color: #666; font-size: 0.9em; margin-top: 5px;">ç‚¹å‡»å•è¯å¡ç‰‡æ—¶æœ—è¯»å•è¯</p>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="click-speak" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn" onclick="testPronunciation()">
                                <span>ğŸµ æµ‹è¯•å‘éŸ³</span>
                            </button>
                            <button class="btn" onclick="resetPronunciationSettings()">
                                <span>ğŸ”„ æ¢å¤é»˜è®¤</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- æµè§ˆå™¨æ”¯æŒæ£€æµ‹ -->
                    <div style="background: #FFF3E0; border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                        <h3 style="color: #333; margin-bottom: 20px;">ğŸŒ æµè§ˆå™¨æ”¯æŒæ£€æµ‹</h3>
                        
                        <div id="browser-support" style="text-align: center; margin: 25px 0;">
                            <p style="color: #666; margin-bottom: 15px;">
                                æ­£åœ¨æ£€æµ‹æµè§ˆå™¨è¯­éŸ³åˆæˆæ”¯æŒ...
                            </p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-blue" onclick="savePronunciationSettings(); alert('âœ… è®¾ç½®å·²ä¿å­˜');">
                            <span>ğŸ’¾ ä¿å­˜è®¾ç½®</span>
                        </button>
                        <button class="btn btn-red" onclick="showStudentMenu()">
                            <span>ğŸ”™ è¿”å›</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€é…ç½® ==========
        const TEACHER_USERNAME = 'kathy151';
        
        let appState = {
            currentUser: null,
            isTeacher: false,
            userWords: [],          // å­¦ç”Ÿçš„å•è¯åº“
            trainingWords: [],      // å½“å‰è®­ç»ƒçš„å•è¯
            currentWordIndex: 0,
            trainingMode: 'en_to_cn', // en_to_cn æˆ– cn_to_en
            cardFlipped: false
        };
        
        // å‘éŸ³è®¾ç½®
        let pronunciationSettings = {
            autoSpeak: true,
            modeSpeak: true,
            clickSpeak: true,
            voice: null,
            speaking: false
        };
        
        // ========== é¡µé¢åˆ‡æ¢å‡½æ•° ==========
        function showScreen(screenId) {
            // éšè—æ‰€æœ‰ç•Œé¢
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡ç•Œé¢
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
            }
        }
        
        function showStudentMenu() {
            showScreen('student-menu');
            updateStudentStats();
        }
        
        function showLogin() {
            showScreen('login-screen');
        }
        
        // ========== ç™»å½•/æ³¨å†ŒåŠŸèƒ½ ==========
        function login() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                alert('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æ•™å¸ˆè´¦å·
            if (username === TEACHER_USERNAME) {
                // æ•™å¸ˆç™»å½•
                appState.currentUser = username;
                appState.isTeacher = true;
                appState.userWords = [];
                
                // ä¿å­˜ç™»å½•çŠ¶æ€
                localStorage.setItem('current_user', username);
                localStorage.setItem('user_role', 'teacher');
                
                alert('ğŸ‘‘ æ¬¢è¿Kathyè€å¸ˆï¼æµ‹è¯•ç‰ˆåªæ”¯æŒå­¦ç”ŸåŠŸèƒ½');
                showLogin();
                return;
            } else {
                // å­¦ç”Ÿç™»å½•
                appState.currentUser = username;
                appState.isTeacher = false;
                
                // æ£€æŸ¥å­¦ç”Ÿæ˜¯å¦å­˜åœ¨
                const savedData = localStorage.getItem(`student_words_${username}`);
                if (!savedData) {
                    if (confirm(`ç”¨æˆ·"${username}"ä¸å­˜åœ¨ï¼Œæ˜¯å¦æ³¨å†Œä¸ºæ–°å­¦ç”Ÿï¼Ÿ`)) {
                        register();
                        return;
                    } else {
                        appState.currentUser = null;
                        return;
                    }
                } else {
                    // åŠ è½½å­¦ç”Ÿæ•°æ®
                    appState.userWords = JSON.parse(savedData);
                }
                
                // ä¿å­˜ç™»å½•çŠ¶æ€
                localStorage.setItem('current_user', username);
                localStorage.setItem('user_role', 'student');
                
                document.getElementById('student-welcome').textContent = `ğŸ“ æ¬¢è¿ï¼Œ${username}ï¼`;
                
                // åˆå§‹åŒ–å‘éŸ³ç³»ç»Ÿ
                initPronunciation();
                
                showStudentMenu();
            }
        }
        
        function register() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                alert('è¯·è¾“å…¥ç”¨æˆ·å');
                return;
            }
            
            if (username.length < 2) {
                alert('ç”¨æˆ·åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const savedData = localStorage.getItem(`student_words_${username}`);
            if (savedData) {
                alert('ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·ç›´æ¥ç™»å½•');
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ•™å¸ˆç”¨æˆ·å
            if (username.toLowerCase() === TEACHER_USERNAME.toLowerCase()) {
                alert('è¯¥ç”¨æˆ·åä¸å¯ç”¨');
                return;
            }
            
            // åˆ›å»ºæ–°å­¦ç”Ÿ
            appState.currentUser = username;
            appState.isTeacher = false;
            appState.userWords = [];
            
            // ä¿å­˜å­¦ç”Ÿæ•°æ®
            localStorage.setItem(`student_words_${username}`, JSON.stringify([]));
            
            // ä¿å­˜å­¦ç”Ÿä¿¡æ¯
            const studentInfo = {
                username: username,
                created: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            localStorage.setItem(`student_info_${username}`, JSON.stringify(studentInfo));
            
            // ä¿å­˜ç™»å½•çŠ¶æ€
            localStorage.setItem('current_user', username);
            localStorage.setItem('user_role', 'student');
            
            // åˆå§‹åŒ–å‘éŸ³ç³»ç»Ÿ
            initPronunciation();
            
            document.getElementById('student-welcome').textContent = `ğŸ“ æ¬¢è¿ï¼Œ${username}ï¼`;
            showStudentMenu();
            alert(`âœ… æ¬¢è¿ ${username} åŠ å…¥æµ‹è¯•ï¼\n\nç°åœ¨å¯ä»¥æµ‹è¯•çŸ­è¯­å¯¼å…¥å’Œå‘éŸ³åŠŸèƒ½ã€‚`);
        }
        
        // ========== çŸ­è¯­å¯¼å…¥åŠŸèƒ½ ==========
        function showAddWords() {
            showScreen('add-words-screen');
        }
        
        function pasteFromClipboard() {
            if (navigator.clipboard) {
                navigator.clipboard.readText()
                    .then(text => {
                        document.getElementById('word-input').value = text;
                        alert('ğŸ“‹ å·²ä»å‰ªè´´æ¿ç²˜è´´å†…å®¹');
                    })
                    .catch(err => {
                        alert('æ— æ³•è®¿é—®å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´');
                    });
            } else {
                alert('æµè§ˆå™¨ä¸æ”¯æŒå‰ªè´´æ¿è®¿é—®');
            }
        }
        
        function loadExampleWords() {
            const examples = `# æµ‹è¯•ç¤ºä¾‹ - å•è¯å’ŒçŸ­è¯­
# ç®€å•å•è¯
hello ä½ å¥½
world ä¸–ç•Œ
apple è‹¹æœ
computer ç”µè„‘

# çŸ­è¯­ï¼ˆä½¿ç”¨å¼•å·ï¼‰
"good morning" æ—©ä¸Šå¥½
'how are you' = ä½ å¥½å—
"thank you" è°¢è°¢ä½ 
"good night" æ™šå®‰

# ä¸­è‹±æ··åˆ
"æ—©ä¸Šå¥½" good morning
"å†è§" goodbye
"æˆ‘çˆ±ä½ " I love you

# å…¶ä»–æ ¼å¼æµ‹è¯•
book:ä¹¦
water=æ°´
friendï¼Œæœ‹å‹`;
            
            document.getElementById('word-input').value = examples;
            alert('ğŸ“š å·²åŠ è½½æµ‹è¯•ç¤ºä¾‹');
        }
        
        function importWords() {
            const input = document.getElementById('word-input').value.trim();
            
            if (!input) {
                alert('è¯·è¾“å…¥å•è¯æˆ–çŸ­è¯­');
                return;
            }
            
            const lines = input.split('\n');
            let added = 0;
            let duplicates = 0;
            let errorCount = 0;
            let errors = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                const trimmed = line.trim();
                
                // è·³è¿‡æ³¨é‡Šè¡Œå’Œç©ºè¡Œ
                if (!trimmed || trimmed.startsWith('#')) continue;
                
                let english = '', chinese = '';
                
                // æ–¹æ¡ˆ1ï¼šå°è¯•åŒ¹é…å¼•å·æ ¼å¼ï¼ˆæ”¯æŒçŸ­è¯­ï¼‰
                const quoteMatch = trimmed.match(/^["'ã€Œã€]([^"ã€]+)["'ã€Œã€]\s*([:=\sï¼Œ,])\s*(.+)$/);
                
                if (quoteMatch) {
                    // å¦‚æœä½¿ç”¨å¼•å·æ ¼å¼
                    english = quoteMatch[1].trim();
                    chinese = quoteMatch[3].trim();
                } else {
                    // æ–¹æ¡ˆ2ï¼šä½¿ç”¨åŸæœ‰çš„è§£æé€»è¾‘ï¼ˆç”¨äºæ™®é€šå•è¯ï¼‰
                    const separators = [' ', ':', '=', ',', 'ï¼š', 'ï¼Œ'];
                    let foundSeparator = false;
                    
                    for (const sep of separators) {
                        if (trimmed.includes(sep)) {
                            const parts = trimmed.split(sep);
                            if (parts.length >= 2) {
                                english = parts[0].trim();
                                chinese = parts.slice(1).join(sep).trim();
                                foundSeparator = true;
                                break;
                            }
                        }
                    }
                    
                    // æ–¹æ¡ˆ3ï¼šå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ†éš”ç¬¦ï¼Œå°è¯•æŒ‰ç©ºæ ¼åˆ†å‰²ï¼ˆç®€å•å•è¯ï¼‰
                    if (!foundSeparator) {
                        const parts = trimmed.split(/\s+/);
                        if (parts.length >= 2) {
                            english = parts[0];
                            chinese = parts.slice(1).join(' ');
                        }
                    }
                }
                
                // æ¸…ç†ä¸­è‹±æ–‡ä¸¤ä¾§å¯èƒ½çš„å¤šä½™å¼•å·
                english = english.replace(/^["'`ã€Œã€]+|["'`ã€Œã€]+$/g, '');
                chinese = chinese.replace(/^["'`ã€Œã€]+|["'`ã€Œã€]+$/g, '');
                
                if (english && chinese) {
                    // æ£€æŸ¥æ˜¯å¦é‡å¤ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
                    const exists = appState.userWords.some(w => 
                        w.english.toLowerCase() === english.toLowerCase()
                    );
                    
                    if (!exists) {
                        // åˆ¤æ–­æ˜¯å•è¯è¿˜æ˜¯çŸ­è¯­
                        const isPhrase = english.includes(' ') || chinese.includes(' ') || 
                                        english.length > 10 || chinese.length > 10;
                        
                        appState.userWords.push({
                            english: english,
                            chinese: chinese,
                            status: '',
                            reviewCount: 0,
                            addedDate: new Date().toISOString(),
                            type: isPhrase ? 'phrase' : 'word',
                            isPhrase: isPhrase
                        });
                        added++;
                    } else {
                        duplicates++;
                    }
                } else {
                    errorCount++;
                    errors.push(`ç¬¬${i+1}è¡Œ: ${trimmed}`);
                }
            }
            
            // ä¿å­˜æ•°æ®
            saveStudentData();
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('import-result');
            let resultHTML = `<h4>ğŸ“¥ å¯¼å…¥ç»“æœ</h4>`;
            resultHTML += `<p>âœ… æˆåŠŸå¯¼å…¥: <strong>${added}</strong> ä¸ªæ–°å•è¯/çŸ­è¯­</p>`;
            
            if (duplicates > 0) {
                resultHTML += `<p>âš ï¸ è·³è¿‡é‡å¤: <strong>${duplicates}</strong> ä¸ª</p>`;
            }
            
            if (errorCount > 0) {
                resultHTML += `<p>âŒ æ ¼å¼é”™è¯¯: <strong>${errorCount}</strong> ä¸ª</p>`;
                resultHTML += `<div style="margin-top: 10px; padding: 10px; background: #ffebee; border-radius: 5px;">`;
                resultHTML += `<p><strong>é”™è¯¯è¡Œ:</strong></p>`;
                resultHTML += `<ul style="margin-left: 20px; color: #d32f2f;">`;
                errors.forEach(error => {
                    resultHTML += `<li>${error}</li>`;
                });
                resultHTML += `</ul></div>`;
                
                resultHTML += `<div style="margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 5px;">`;
                resultHTML += `<p><strong>ğŸ’¡ æ­£ç¡®æ ¼å¼ç¤ºä¾‹:</strong></p>`;
                resultHTML += `<ol style="margin-left: 20px;">`;
                resultHTML += `<li><code>hello ä½ å¥½</code> (ç®€å•å•è¯)</li>`;
                resultHTML += `<li><code>"good morning" æ—©ä¸Šå¥½</code> (çŸ­è¯­å¸¦å¼•å·)</li>`;
                resultHTML += `<li><code>'how are you' = ä½ å¥½å—</code> (å•å¼•å·)</li>`;
                resultHTML += `<li><code>apple:è‹¹æœ</code> (ä½¿ç”¨å†’å·)</li>`;
                resultHTML += `<li><code>bookï¼Œä¹¦</code> (ä½¿ç”¨ä¸­æ–‡é€—å·)</li>`;
                resultHTML += `</ol></div>`;
            }
            
            resultHTML += `<p>ğŸ“Š å½“å‰æ€»æ•°: <strong>${appState.userWords.length}</strong></p>`;
            
            if (added > 0) {
                resultHTML += `<p style="color: #4CAF50;">ğŸ’¡ å¯¼å…¥æˆåŠŸï¼ç°åœ¨å¯ä»¥å¼€å§‹è®­ç»ƒæµ‹è¯•å‘éŸ³åŠŸèƒ½ï¼</p>`;
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('word-input').value = '';
            }
            
            resultDiv.innerHTML = resultHTML;
            resultDiv.style.display = 'block';
            
            // æ›´æ–°ç»Ÿè®¡
            updateStudentStats();
        }
        
        // ========== å‘éŸ³åŠŸèƒ½ ==========
        function initPronunciation() {
            // ä»localStorageåŠ è½½å‘éŸ³è®¾ç½®
            const savedSettings = localStorage.getItem(`pronunciation_settings_${appState.currentUser}`);
            if (savedSettings) {
                Object.assign(pronunciationSettings, JSON.parse(savedSettings));
            }
            
            // æ›´æ–°è®¾ç½®ç•Œé¢
            updatePronunciationSettingsUI();
            
            // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
            initSpeechSynthesis();
            
            // æ£€æµ‹æµè§ˆå™¨æ”¯æŒ
            checkBrowserSupport();
        }
        
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                // ç­‰å¾…è¯­éŸ³åˆ—è¡¨åŠ è½½
                setTimeout(() => {
                    const voices = speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        // ä¼˜å…ˆé€‰æ‹©è‹±æ–‡è¯­éŸ³
                        const englishVoice = voices.find(voice => 
                            voice.lang.startsWith('en') && 
                            (voice.name.includes('US') || voice.name.includes('UK'))
                        );
                        pronunciationSettings.voice = englishVoice || voices[0];
                    }
                }, 100);
            }
        }
        
        function checkBrowserSupport() {
            const supportDiv = document.getElementById('browser-support');
            if (!supportDiv) return;
            
            if ('speechSynthesis' in window) {
                supportDiv.innerHTML = `
                    <p style="color: #4CAF50; font-weight: bold;">âœ… æµè§ˆå™¨æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½</p>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        å¯ä»¥æ­£å¸¸ä½¿ç”¨å‘éŸ³åŠŸèƒ½
                    </p>
                `;
            } else {
                supportDiv.innerHTML = `
                    <p style="color: #F44336; font-weight: bold;">âŒ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ</p>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        å»ºè®®ä½¿ç”¨ Chromeã€Edge æˆ– Safari æµè§ˆå™¨
                    </p>
                `;
            }
        }
        
        function speakText(text, language = 'en-US') {
            if (!('speechSynthesis' in window) || pronunciationSettings.speaking) {
                console.warn('è¯­éŸ³åˆæˆä¸å¯ç”¨æˆ–æ­£åœ¨å‘éŸ³');
                return false;
            }
            
            // åœæ­¢å½“å‰å‘éŸ³
            speechSynthesis.cancel();
            
            // åˆ›å»ºæ–°çš„å‘éŸ³
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = language;
            utterance.rate = 0.9; // è¯­é€Ÿ
            utterance.pitch = 1.0; // éŸ³è°ƒ
            utterance.volume = 1.0; // éŸ³é‡
            
            if (pronunciationSettings.voice) {
                utterance.voice = pronunciationSettings.voice;
            }
            
            // å¼€å§‹å‘éŸ³
            pronunciationSettings.speaking = true;
            updateSpeakButtonState(true);
            
            utterance.onstart = function() {
                console.log('å¼€å§‹å‘éŸ³:', text, 'è¯­è¨€:', language);
            };
            
            utterance.onend = function() {
                pronunciationSettings.speaking = false;
                updateSpeakButtonState(false);
            };
            
            utterance.onerror = function(event) {
                console.error('å‘éŸ³é”™è¯¯:', event);
                pronunciationSettings.speaking = false;
                updateSpeakButtonState(false);
                alert('å‘éŸ³å¤±è´¥ï¼š' + (event.error || 'æœªçŸ¥é”™è¯¯'));
            };
            
            speechSynthesis.speak(utterance);
            return true;
        }
        
        function speakCurrentWord(event = null) {
            if (event) event.stopPropagation();
            
            if (appState.currentWordIndex >= appState.trainingWords.length) {
                alert('è¯·å…ˆå¼€å§‹è®­ç»ƒ');
                return;
            }
            
            const word = appState.trainingWords[appState.currentWordIndex];
            const isFlipped = appState.cardFlipped;
            
            // æ ¹æ®å¡ç‰‡çŠ¶æ€å†³å®šæœ—è¯»å†…å®¹
            if (isFlipped) {
                // å¡ç‰‡å·²ç¿»è½¬ï¼Œæœ—è¯»ä¸­æ–‡
                if (!speakText(word.chinese, 'zh-CN')) {
                    alert('ä¸­æ–‡å‘éŸ³å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                }
            } else {
                // å¡ç‰‡æœªç¿»è½¬ï¼Œæ ¹æ®è®­ç»ƒæ¨¡å¼å†³å®šæœ—è¯»å†…å®¹
                if (appState.trainingMode === 'en_to_cn') {
                    if (!speakText(word.english, 'en-US')) {
                        alert('è‹±æ–‡å‘éŸ³å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                    }
                } else {
                    if (!speakText(word.chinese, 'zh-CN')) {
                        alert('ä¸­æ–‡å‘éŸ³å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                    }
                }
            }
        }
        
        function updateSpeakButtonState(isSpeaking) {
            const speakButton = document.getElementById('speak-button');
            if (speakButton) {
                if (isSpeaking) {
                    speakButton.classList.add('speaking');
                    speakButton.textContent = 'ğŸ”Š';
                    speakButton.title = 'æ­£åœ¨å‘éŸ³...';
                } else {
                    speakButton.classList.remove('speaking');
                    speakButton.textContent = 'ğŸ”Š';
                    speakButton.title = 'ç‚¹å‡»å‘éŸ³';
                }
            }
        }
        
        function handleCardClick() {
            const clickSpeak = document.getElementById('click-speak')?.checked ?? pronunciationSettings.clickSpeak;
            
            // å¦‚æœå¯ç”¨äº†ç‚¹å‡»å‘éŸ³ï¼Œå…ˆå‘éŸ³å†ç¿»è½¬
            if (clickSpeak && !pronunciationSettings.speaking) {
                speakCurrentWord();
            }
            
            // å»¶è¿Ÿç¿»è½¬å¡ç‰‡ï¼Œè®©ç”¨æˆ·å¬åˆ°å‘éŸ³
            setTimeout(flipCard, 300);
        }
        
        function updatePronunciationSettingsUI() {
            // æ›´æ–°è®¾ç½®å¼€å…³çŠ¶æ€
            const autoSpeak = document.getElementById('auto-speak');
            const modeSpeak = document.getElementById('mode-speak');
            const clickSpeak = document.getElementById('click-speak');
            
            if (autoSpeak) autoSpeak.checked = pronunciationSettings.autoSpeak;
            if (modeSpeak) modeSpeak.checked = pronunciationSettings.modeSpeak;
            if (clickSpeak) clickSpeak.checked = pronunciationSettings.clickSpeak;
        }
        
        function savePronunciationSettings() {
            // ä»ç•Œé¢è·å–æœ€æ–°è®¾ç½®
            const autoSpeak = document.getElementById('auto-speak');
            const modeSpeak = document.getElementById('mode-speak');
            const clickSpeak = document.getElementById('click-speak');
            
            if (autoSpeak && modeSpeak && clickSpeak) {
                pronunciationSettings.autoSpeak = autoSpeak.checked;
                pronunciationSettings.modeSpeak = modeSpeak.checked;
                pronunciationSettings.clickSpeak = clickSpeak.checked;
                
                // ä¿å­˜åˆ°localStorage
                if (appState.currentUser) {
                    localStorage.setItem(
                        `pronunciation_settings_${appState.currentUser}`, 
                        JSON.stringify(pronunciationSettings)
                    );
                }
            }
        }
        
        function testPronunciation() {
            const testWords = [
                { text: "hello", lang: "en-US", desc: "è‹±æ–‡å•è¯" },
                { text: "world", lang: "en-US", desc: "è‹±æ–‡å•è¯" },
                { text: "good morning", lang: "en-US", desc: "è‹±æ–‡çŸ­è¯­" },
                { text: "ä½ å¥½", lang: "zh-CN", desc: "ä¸­æ–‡å•è¯" },
                { text: "æ—©ä¸Šå¥½", lang: "zh-CN", desc: "ä¸­æ–‡çŸ­è¯­" }
            ];
            
            let index = 0;
            
            function speakNext() {
                if (index < testWords.length) {
                    const word = testWords[index];
                    const result = speakText(word.text, word.lang);
                    
                    if (!result) {
                        alert(`å‘éŸ³æµ‹è¯•å¤±è´¥ï¼š${word.desc} - ${word.text}`);
                        return;
                    }
                    
                    // ç­‰å¾…å‘éŸ³å®Œæˆ
                    setTimeout(() => {
                        index++;
                        if (index < testWords.length) {
                            speakNext();
                        } else {
                            alert('âœ… å‘éŸ³æµ‹è¯•å®Œæˆï¼');
                        }
                    }, 1500);
                }
            }
            
            speakNext();
        }
        
        function resetPronunciationSettings() {
            pronunciationSettings = {
                autoSpeak: true,
                modeSpeak: true,
                clickSpeak: true,
                voice: pronunciationSettings.voice, // ä¿ç•™è¯­éŸ³è®¾ç½®
                speaking: false
            };
            
            updatePronunciationSettingsUI();
            savePronunciationSettings();
            alert('âœ… å‘éŸ³è®¾ç½®å·²æ¢å¤ä¸ºé»˜è®¤å€¼');
        }
        
        function showSettings() {
            showScreen('settings-screen');
            initPronunciation(); // åˆå§‹åŒ–å‘éŸ³è®¾ç½®
        }
        
        // ========== å­¦ç”ŸåŠŸèƒ½ ==========
        function updateStudentStats() {
            const statsDiv = document.getElementById('student-stats');
            
            const totalWords = appState.userWords.length;
            const remembered = appState.userWords.filter(w => w.status === 'remembered').length;
            const fuzzy = appState.userWords.filter(w => w.status === 'fuzzy').length;
            const forgot = appState.userWords.filter(w => w.status === 'forgot' || !w.status).length;
            const progress = totalWords > 0 ? Math.round((remembered / totalWords) * 100) : 0;
            
            // ç»Ÿè®¡çŸ­è¯­æ•°é‡
            const phraseCount = appState.userWords.filter(w => w.isPhrase).length;
            
            statsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="font-size: 1.8em; color: #2196F3; font-weight: bold;">${totalWords}</div>
                        <div style="color: #666; font-size: 0.9em;">å•è¯/çŸ­è¯­æ€»æ•°</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="font-size: 1.8em; color: #9C27B0; font-weight: bold;">${phraseCount}</div>
                        <div style="color: #666; font-size: 0.9em;">çŸ­è¯­æ•°é‡</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="font-size: 1.8em; color: #4CAF50; font-weight: bold;">${remembered}</div>
                        <div style="color: #666; font-size: 0.9em;">å·²æŒæ¡</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                        <div style="font-size: 1.8em; color: #FF9800; font-weight: bold;">${fuzzy}</div>
                        <div style="color: #666; font-size: 0.9em;">å­¦ä¹ ä¸­</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #666;">æŒæ¡è¿›åº¦</span>
                        <span style="color: #4CAF50; font-weight: bold;">${progress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
                
                ${totalWords === 0 ? `
                <div style="margin-top: 30px; padding: 15px; background: #FFF3E0; border-radius: 10px;">
                    <p style="color: #FF9800; text-align: center;">
                        ğŸ§ª <strong>æµ‹è¯•å»ºè®®ï¼š</strong>å…ˆå»æ·»åŠ ä¸€äº›å•è¯å’ŒçŸ­è¯­ï¼Œç„¶åå¼€å§‹è®­ç»ƒæµ‹è¯•å‘éŸ³åŠŸèƒ½
                    </p>
                </div>
                ` : ''}
            `;
        }
        
        function startTraining() {
            if (appState.userWords.length === 0) {
                alert('è¯·å…ˆæ·»åŠ å•è¯/çŸ­è¯­ï¼Œç„¶åå¼€å§‹è®­ç»ƒ');
                showAddWords();
                return;
            }
            
            // å‡†å¤‡è®­ç»ƒå•è¯
            appState.trainingWords = [...appState.userWords];
            appState.trainingWords.sort(() => Math.random() - 0.5);
            appState.currentWordIndex = 0;
            appState.trainingMode = 'en_to_cn';
            appState.cardFlipped = false;
            
            showScreen('train-screen');
            showCurrentWord();
            
            // å¦‚æœå¯ç”¨è‡ªåŠ¨å‘éŸ³ï¼Œæœ—è¯»ç¬¬ä¸€ä¸ªå•è¯
            if (pronunciationSettings.autoSpeak) {
                setTimeout(() => {
                    speakCurrentWord();
                }, 500);
            }
        }
        
        function showCurrentWord() {
            if (appState.currentWordIndex >= appState.trainingWords.length) {
                endTraining();
                return;
            }
            
            const word = appState.trainingWords[appState.currentWordIndex];
            const cardFront = document.getElementById('card-front');
            const cardBack = document.getElementById('card-back');
            const wordCard = document.getElementById('word-card');
            
            // é‡ç½®å¡ç‰‡çŠ¶æ€
            wordCard.classList.remove('flipped');
            appState.cardFlipped = false;
            cardBack.style.display = 'none';
            
            // æ ¹æ®è®­ç»ƒæ¨¡å¼æ˜¾ç¤ºå†…å®¹
            if (appState.trainingMode === 'en_to_cn') {
                cardFront.textContent = word.english;
                cardBack.textContent = word.chinese;
                document.getElementById('mode-text').textContent = 'è‹±æ–‡ â†’ ä¸­æ–‡';
            } else {
                cardFront.textContent = word.chinese;
                cardBack.textContent = word.english;
                document.getElementById('mode-text').textContent = 'ä¸­æ–‡ â†’ è‹±æ–‡';
            }
            
            // æ›´æ–°è¿›åº¦
            const progress = ((appState.currentWordIndex + 1) / appState.trainingWords.length) * 100;
            document.getElementById('progress-text').textContent = 
                `è¿›åº¦: ${appState.currentWordIndex + 1}/${appState.trainingWords.length}`;
            document.getElementById('train-progress').style.width = `${progress}%`;
            
            // æ›´æ–°å‘éŸ³æŒ‰é’®çŠ¶æ€
            updateSpeakButtonState(false);
            
            // å¦‚æœå¯ç”¨è‡ªåŠ¨å‘éŸ³ï¼Œæœ—è¯»å½“å‰å•è¯
            if (pronunciationSettings.autoSpeak) {
                setTimeout(() => {
                    speakCurrentWord();
                }, 300);
            }
        }
        
        function flipCard() {
            if (appState.currentWordIndex >= appState.trainingWords.length) return;
            
            const cardBack = document.getElementById('card-back');
            const wordCard = document.getElementById('word-card');
            
            if (!appState.cardFlipped) {
                cardBack.style.display = 'block';
                wordCard.classList.add('flipped');
                appState.cardFlipped = true;
            } else {
                cardBack.style.display = 'none';
                wordCard.classList.remove('flipped');
                appState.cardFlipped = false;
            }
        }
        
        function toggleTrainingMode() {
            appState.trainingMode = appState.trainingMode === 'en_to_cn' ? 'cn_to_en' : 'en_to_cn';
            appState.cardFlipped = false;
            
            // å¦‚æœå¯ç”¨æ¨¡å¼åˆ‡æ¢å‘éŸ³ï¼Œæœ—è¯»å•è¯
            if (pronunciationSettings.modeSpeak) {
                speakCurrentWord();
            }
            
            showCurrentWord();
        }
        
        function shuffleWords() {
            // éšæœºæ‰“ä¹±å‰©ä½™å•è¯
            const remainingWords = appState.trainingWords.slice(appState.currentWordIndex);
            for (let i = remainingWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [remainingWords[i], remainingWords[j]] = [remainingWords[j], remainingWords[i]];
            }
            
            appState.trainingWords = [
                ...appState.trainingWords.slice(0, appState.currentWordIndex),
                ...remainingWords
            ];
            
            showCurrentWord();
            alert('ğŸ² å•è¯é¡ºåºå·²é‡æ–°æ‰“ä¹±');
        }
        
        function markWord(status) {
            if (appState.currentWordIndex >= appState.trainingWords.length) return;
            
            const word = appState.trainingWords[appState.currentWordIndex];
            
            // æ›´æ–°å•è¯çŠ¶æ€
            word.status = status;
            word.reviewCount = (word.reviewCount || 0) + 1;
            word.lastReview = new Date().toISOString();
            
            // æ›´æ–°åŸå§‹æ•°æ®
            const index = appState.userWords.findIndex(w => w.english === word.english);
            if (index !== -1) {
                appState.userWords[index] = word;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveStudentData();
            
            // ä¸‹ä¸€ä¸ªå•è¯
            appState.currentWordIndex++;
            appState.cardFlipped = false;
            
            // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºä¸‹ä¸€ä¸ªå•è¯
            setTimeout(showCurrentWord, 300);
        }
        
        function skipWord() {
            appState.currentWordIndex++;
            appState.cardFlipped = false;
            showCurrentWord();
        }
        
        function endTraining() {
            const remembered = appState.userWords.filter(w => w.status === 'remembered').length;
            const total = appState.userWords.length;
            const score = total > 0 ? Math.round((remembered / total) * 100) : 0;
            
            let message = `ğŸ‰ è®­ç»ƒå®Œæˆï¼\n\n`;
            message += `ğŸ“Š è®­ç»ƒç»Ÿè®¡ï¼š\n`;
            message += `âœ… è®°å¾—ï¼š${appState.userWords.filter(w => w.status === 'remembered').length}\n`;
            message += `ğŸ”„ æ¨¡ç³Šï¼š${appState.userWords.filter(w => w.status === 'fuzzy').length}\n`;
            message += `âŒ å¿˜è®°ï¼š${appState.userWords.filter(w => w.status === 'forgot' || !w.status).length}\n`;
            message += `ğŸ“ˆ æŒæ¡ç‡ï¼š${score}%\n\n`;
            
            if (score >= 80) {
                message += `ğŸŒŸ å¤ªæ£’äº†ï¼ç»§ç»­ä¿æŒï¼`;
            } else if (score >= 60) {
                message += `ğŸ’ª è¿˜ä¸é”™ï¼Œç»§ç»­åŠ æ²¹ï¼`;
            } else {
                message += `ğŸ“š éœ€è¦å¤šå¤ä¹ ï¼Œç»§ç»­åŠªåŠ›ï¼`;
            }
            
            alert(message);
            showStudentMenu();
        }
        
        function showReviewWords() {
            // è·å–éœ€è¦å¤ä¹ çš„å•è¯ï¼ˆå¿˜è®°çš„æˆ–æ¨¡ç³Šçš„ï¼‰
            const reviewWords = appState.userWords.filter(word => 
                word.status === 'forgot' || word.status === 'fuzzy' || !word.status
            );
            
            if (reviewWords.length === 0) {
                alert('ğŸ‰ å¤ªæ£’äº†ï¼æ²¡æœ‰éœ€è¦å¤ä¹ çš„å•è¯ã€‚');
                return;
            }
            
            appState.trainingWords = reviewWords;
            appState.currentWordIndex = 0;
            appState.trainingMode = 'en_to_cn';
            appState.cardFlipped = false;
            
            showScreen('train-screen');
            showCurrentWord();
            
            alert(`ğŸ“š å¼€å§‹å¤ä¹  ${reviewWords.length} ä¸ªå¼±é¡¹å•è¯`);
        }
        
        // ========== æ•°æ®æŒä¹…åŒ– ==========
        function saveStudentData() {
            if (appState.currentUser && !appState.isTeacher) {
                localStorage.setItem(`student_words_${appState.currentUser}`, JSON.stringify(appState.userWords));
                
                // æ›´æ–°æœ€åç™»å½•æ—¶é—´
                const studentInfo = JSON.parse(localStorage.getItem(`student_info_${appState.currentUser}`) || '{}');
                studentInfo.lastLogin = new Date().toISOString();
                localStorage.setItem(`student_info_${appState.currentUser}`, JSON.stringify(studentInfo));
            }
        }
        
        // ========== é€€å‡ºç™»å½• ==========
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                appState.currentUser = null;
                appState.isTeacher = false;
                appState.userWords = [];
                localStorage.removeItem('current_user');
                localStorage.removeItem('user_role');
                document.getElementById('username').value = '';
                showLogin();
            }
        }
        
        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥æµ‹è¯•ç‰ˆå¯åŠ¨');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ç™»å½•ç”¨æˆ·
            const savedUser = localStorage.getItem('current_user');
            const savedRole = localStorage.getItem('user_role');
            
            if (savedUser) {
                appState.currentUser = savedUser;
                appState.isTeacher = (savedRole === 'teacher');
                
                if (!appState.isTeacher) {
                    // åŠ è½½å­¦ç”Ÿæ•°æ®
                    const savedData = localStorage.getItem(`student_words_${savedUser}`);
                    if (savedData) {
                        appState.userWords = JSON.parse(savedData);
                    }
                    document.getElementById('student-welcome').textContent = `ğŸ“ æ¬¢è¿ï¼Œ${savedUser}ï¼`;
                    
                    // åˆå§‹åŒ–å‘éŸ³ç³»ç»Ÿ
                    initPronunciation();
                    
                    showStudentMenu();
                } else {
                    // æ•™å¸ˆç™»å½•ç›´æ¥è½¬åˆ°å­¦ç”Ÿèœå•æµ‹è¯•
                    appState.currentUser = 'test_user';
                    appState.isTeacher = false;
                    document.getElementById('student-welcome').textContent = `ğŸ“ æ¬¢è¿æµ‹è¯•ï¼`;
                    
                    // åˆå§‹åŒ–å‘éŸ³ç³»ç»Ÿ
                    initPronunciation();
                    
                    showStudentMenu();
                }
            }
            
            // ç»‘å®šå›è½¦é”®
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });
    </script>
</body>
</html>
