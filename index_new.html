<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kathyå•è¯è®­ç»ƒè¥ - åˆ†ç»„ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #2C3E50 0%, #4A6491 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; color: #F1C40F; }
        .main-content { padding: 30px; }
        .screen { display: none; animation: fadeIn 0.5s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .btn { background: #4CAF50; color: white; border: none; padding: 14px 28px; margin: 10px; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; }
        .btn:hover { background: #45a049; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn-blue { background: #2196F3; } .btn-blue:hover { background: #1976D2; }
        .btn-red { background: #F44336; } .btn-red:hover { background: #D32F2F; }
        .btn-purple { background: #9C27B0; } .btn-purple:hover { background: #7B1FA2; }
        
        input[type="text"] { width: 100%; max-width: 500px; padding: 16px; margin: 12px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; }
        
        #login-message {
            padding: 15px;
            border-radius: 8px;
            margin: 10px auto;
            max-width: 500px;
            transition: all 0.3s;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-online { background: #4CAF50; }
        .status-offline { background: #F44336; }
        .status-connecting { background: #FFC107; }
        
        @media (max-width: 768px) {
            .container { margin: 10px; border-radius: 15px; }
            .header { padding: 20px; }
            .header h1 { font-size: 1.8em; }
            .btn { padding: 12px 20px; margin: 8px; font-size: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Kathyå•è¯è®­ç»ƒè¥ - åˆ†ç»„ç³»ç»Ÿ</h1>
            <p style="color: #BDC3C7; font-size: 0.9em;">ğŸ‘‘ æ•™å¸ˆï¼šKathy | ğŸ’¬ å¾®ä¿¡ï¼šKathy151 | ğŸ¯ åˆ†ç»„ç®¡ç†å•è¯</p>
        </div>
        
        <div class="main-content">
            <!-- ç™»å½•ç•Œé¢ -->
            <div id="login-screen" class="screen active">
                <div style="text-align: center;">
                    <h2>ğŸ‘‘ æ¬¢è¿ä½¿ç”¨åˆ†ç»„å•è¯ç³»ç»Ÿ</h2>
                    <p style="color: #666; margin-bottom: 30px;">æ•™å¸ˆåˆ›å»ºåˆ†ç»„ï¼Œä¸ºä¸åŒå­¦ç”Ÿåˆ†é…ä¸åŒå•è¯</p>
                    
                    <div style="margin: 30px 0;">
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autofocus>
                        <div id="login-message">
                            <span id="connection-status" class="status-indicator status-connecting"></span>
                            <span id="connection-text">æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...</span>
                        </div>
                        
                        <div style="margin: 25px 0;">
                            <button class="btn" onclick="handleLogin()">ğŸ”‘ ç™»å½•/æ³¨å†Œ</button>
                            <button class="btn btn-blue" onclick="testConnection()">ğŸ”§ æµ‹è¯•è¿æ¥</button>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; margin: 30px 0;">
                        <h3 style="color: #2C3E50; margin-bottom: 20px;">ğŸ“± ç³»ç»Ÿç‰¹è‰²</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                                <div style="font-size: 2em;">ğŸ‘¥</div>
                                <div style="font-weight: bold; margin: 10px 0;">åˆ†ç»„ç®¡ç†</div>
                                <div>ä¸ºä¸åŒå­¦ç”Ÿåˆ›å»ºä¸åŒåˆ†ç»„</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                                <div style="font-size: 2em;">ğŸ¯</div>
                                <div style="font-weight: bold; margin: 10px 0;">ç²¾å‡†åˆ†é…</div>
                                <div>æŒ‡å®šå­¦ç”Ÿå­¦ä¹ çš„å•è¯</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: white; border-radius: 10px;">
                                <div style="font-size: 2em;">ğŸ“Š</div>
                                <div style="font-weight: bold; margin: 10px 0;">è¿›åº¦ç›‘æ§</div>
                                <div>æŸ¥çœ‹æ¯ä¸ªåˆ†ç»„å­¦ä¹ æƒ…å†µ</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <p><strong>æµ‹è¯•è´¦å·ï¼š</strong></p>
                            <p>â€¢ æ•™å¸ˆï¼škathy151</p>
                            <p>â€¢ å­¦ç”Ÿï¼šä»»æ„è‹±æ–‡åæ³¨å†Œ</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ•™å¸ˆä¸»ç•Œé¢ -->
            <div id="teacher-screen" class="screen">
                <h2 style="text-align: center; margin-bottom: 30px;">ğŸ‘‘ åˆ†ç»„ç®¡ç†ç³»ç»Ÿ</h2>
                
                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn btn-purple" onclick="showGroups()">ğŸ‘¥ åˆ†ç»„ç®¡ç†</button>
                    <button class="btn btn-blue" onclick="showGroupWords()">ğŸ“ åˆ†ç»„å•è¯</button>
                    <button class="btn" onclick="showAllStudents()">ğŸ“ å­¦ç”Ÿç®¡ç†</button>
                    <button class="btn btn-red" onclick="handleLogout()" style="margin-top: 20px;">ğŸšª é€€å‡ºç™»å½•</button>
                </div>
                
                <div id="teacher-content">
                    <!-- æ•™å¸ˆåŠŸèƒ½å†…å®¹åŒº -->
                </div>
            </div>
            
            <!-- å­¦ç”Ÿä¸»ç•Œé¢ -->
            <div id="student-screen" class="screen">
                <h2 id="student-welcome" style="text-align: center; margin-bottom: 30px;">ğŸ“ æˆ‘çš„å­¦ä¹ ä¸­å¿ƒ</h2>
                
                <div style="text-align: center; margin: 30px 0;">
                    <button class="btn" onclick="startLearning()">ğŸ¯ å¼€å§‹å­¦ä¹ </button>
                    <button class="btn btn-blue" onclick="showMyWords()">ğŸ“– æˆ‘çš„å•è¯</button>
                    <button class="btn" onclick="showMyGroups()">ğŸ‘¥ æˆ‘çš„åˆ†ç»„</button>
                    <button class="btn btn-red" onclick="handleLogout()" style="margin-top: 20px;">ğŸšª é€€å‡ºç™»å½•</button>
                </div>
                
                <div id="student-content">
                    <!-- å­¦ç”ŸåŠŸèƒ½å†…å®¹åŒº -->
                </div>
            </div>
        </div>
    </div>

<script>
// ========== é…ç½® ==========
const SUPABASE_URL = 'https://lctdyhtydcqhloibogyj.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjdGR5aHR5ZGNxaGxvaWJvZ3lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MTM1NTksImV4cCI6MjA4NDM4OTU1OX0.enKrwAeSpQ1QHIUZbU-2rTdDI-ALLXkq3YCdvvQO3lM';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ========== å…¨å±€çŠ¶æ€ ==========
const app = {
    user: null,
    isTeacher: false,
    userId: null,
    teacherId: 'kathy151'
};

// ========== å·¥å…·å‡½æ•° ==========
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
}

function updateConnectionStatus(isConnected, message) {
    const statusIndicator = document.getElementById('connection-status');
    const statusText = document.getElementById('connection-text');
    const loginMessage = document.getElementById('login-message');
    
    if (isConnected === true) {
        statusIndicator.className = 'status-indicator status-online';
        statusText.textContent = 'âœ… ' + message;
        loginMessage.style.background = '#D4EDDA';
        loginMessage.style.color = '#155724';
    } else if (isConnected === false) {
        statusIndicator.className = 'status-indicator status-offline';
        statusText.textContent = 'âŒ ' + message;
        loginMessage.style.background = '#F8D7DA';
        loginMessage.style.color = '#721C24';
    } else {
        statusIndicator.className = 'status-indicator status-connecting';
        statusText.textContent = 'ğŸ”„ ' + message;
        loginMessage.style.background = '#FFF3CD';
        loginMessage.style.color = '#856404';
    }
}

function showAlert(message, type = 'info') {
    alert(`${type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ’¡'} ${message}`);
}

// ========== ç™»å½•ç³»ç»Ÿ ==========
async function handleLogin() {
    const username = document.getElementById('username').value.trim();
    if (!username) {
        showAlert('è¯·è¾“å…¥ç”¨æˆ·å', 'error');
        return;
    }
    
    updateConnectionStatus(null, 'æ­£åœ¨ç™»å½•...');
    
    try {
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
        const { data: existingUser, error: checkError } = await supabase
            .from('users')
            .select('*')
            .eq('username', username)
            .single();
        
        if (checkError && checkError.code === 'PGRST116') {
            // æ–°ç”¨æˆ·æ³¨å†Œ
            const isTeacherAccount = username.toLowerCase() === app.teacherId.toLowerCase();
            
            const { data: newUser, error: createError } = await supabase
                .from('users')
                .insert([{
                    username: username,
                    is_teacher: isTeacherAccount,
                    teacher_id: isTeacherAccount ? username : 'kathy151',
                    last_login: new Date().toISOString()
                }])
                .select()
                .single();
            
            if (createError) throw createError;
            
            app.user = username;
            app.isTeacher = isTeacherAccount;
            app.userId = username;
            
            updateConnectionStatus(true, `æ¬¢è¿æ–°ç”¨æˆ· ${username}ï¼`);
            
        } else if (checkError) {
            throw checkError;
        } else {
            // è€ç”¨æˆ·ç™»å½•
            app.user = username;
            app.isTeacher = existingUser.is_teacher;
            app.userId = username;
            
            await supabase
                .from('users')
                .update({ last_login: new Date().toISOString() })
                .eq('username', username);
            
            updateConnectionStatus(true, `æ¬¢è¿å›æ¥ ${username}ï¼`);
        }
        
        // ä¿å­˜ç™»å½•çŠ¶æ€
        localStorage.setItem('kathy_user', username);
        localStorage.setItem('kathy_role', app.isTeacher ? 'teacher' : 'student');
        
        // è·³è½¬
        setTimeout(() => {
            if (app.isTeacher) {
                showScreen('teacher-screen');
                loadTeacherHome();
            } else {
                showScreen('student-screen');
                document.getElementById('student-welcome').textContent = `ğŸ“ æ¬¢è¿ï¼Œ${username}ï¼`;
                loadStudentHome();
            }
        }, 1000);
        
    } catch (error) {
        console.error('ç™»å½•é”™è¯¯:', error);
        updateConnectionStatus(false, `ç™»å½•å¤±è´¥ï¼š${error.message}`);
    }
}

// ========== æ•™å¸ˆåŠŸèƒ½ ==========
async function loadTeacherHome() {
    const content = document.getElementById('teacher-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 20px;">âœ¨ åˆ†ç»„ç®¡ç†ç³»ç»Ÿ</h3>
            <p style="color: #666; margin-bottom: 30px;">åˆ›å»ºåˆ†ç»„ï¼Œä¸ºä¸åŒå­¦ç”Ÿåˆ†é…ä¸åŒçš„å•è¯</p>
            
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
                <h4 style="color: #333; margin-bottom: 15px;">ğŸ’¡ ä½¿ç”¨æµç¨‹</h4>
                <p style="color: #666; margin: 8px 0;">1. åˆ›å»ºåˆ†ç»„ï¼ˆå¦‚ï¼šåŸºç¡€ç­ã€æé«˜ç­ï¼‰</p>
                <p style="color: #666; margin: 8px 0;">2. ä¸ºåˆ†ç»„æ·»åŠ å•è¯</p>
                <p style="color: #666; margin: 8px 0;">3. å°†å­¦ç”Ÿåˆ†é…åˆ°åˆ†ç»„</p>
                <p style="color: #666; margin: 8px 0;">4. å­¦ç”Ÿå³å¯å­¦ä¹ å¯¹åº”åˆ†ç»„çš„å•è¯</p>
            </div>
        </div>
    `;
}

async function showGroups() {
    const content = document.getElementById('teacher-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ‘¥ åˆ†ç»„ç®¡ç†</h3>
            <button class="btn btn-blue" onclick="createNewGroup()">åˆ›å»ºæ–°åˆ†ç»„</button>
            <div id="groups-list" style="margin-top: 30px;">
                <p style="color: #666;">åŠ è½½åˆ†ç»„åˆ—è¡¨...</p>
            </div>
        </div>
    `;
    
    setTimeout(loadGroupsList, 100);
}

async function loadGroupsList() {
    try {
        const { data: groups, error } = await supabase
            .from('word_groups')
            .select('*')
            .eq('teacher_id', app.teacherId)
            .order('created_at', { ascending: false });
        
        if (error) throw error;
        
        const content = document.getElementById('groups-list');
        
        if (!groups || groups.length === 0) {
            content.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 3em; margin-bottom: 20px;">ğŸ“</div>
                    <h3 style="color: #666; margin-bottom: 15px;">è¿˜æ²¡æœ‰åˆ†ç»„</h3>
                    <p style="color: #999; margin-bottom: 25px;">ç‚¹å‡»"åˆ›å»ºæ–°åˆ†ç»„"æŒ‰é’®å¼€å§‹</p>
                </div>
            `;
            return;
        }
        
        let html = '<div style="max-width: 800px; margin: 0 auto;">';
        groups.forEach(group => {
            const createdDate = new Date(group.created_at).toLocaleDateString('zh-CN');
            html += `
                <div style="background: white; border: 1px solid #ddd; border-radius: 10px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="color: #333; margin: 0;">${group.name}</h4>
                            ${group.description ? `<p style="color: #666; margin-top: 5px;">${group.description}</p>` : ''}
                            <p style="color: #999; font-size: 0.9em; margin-top: 5px;">åˆ›å»ºæ—¶é—´: ${createdDate}</p>
                        </div>
                        <button class="btn" style="padding: 8px 16px;" onclick="manageGroupWords(${group.id})">ç®¡ç†å•è¯</button>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        
        content.innerHTML = html;
        
    } catch (error) {
        console.error('åŠ è½½åˆ†ç»„é”™è¯¯:', error);
        document.getElementById('groups-list').innerHTML = 
            '<p style="color: red; text-align: center;">åŠ è½½å¤±è´¥ï¼š' + error.message + '</p>';
    }
}

function createNewGroup() {
    const content = document.getElementById('teacher-content');
    content.innerHTML = `
        <div style="max-width: 600px; margin: 0 auto;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ“ åˆ›å»ºæ–°åˆ†ç»„</h3>
            
            <input type="text" id="group-name" placeholder="è¯·è¾“å…¥åˆ†ç»„åç§°ï¼ˆå¦‚ï¼šåŸºç¡€ç­ï¼‰">
            <textarea id="group-desc" placeholder="åˆ†ç»„æè¿°ï¼ˆå¯é€‰ï¼‰" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin: 10px 0; height: 100px;"></textarea>
            
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-blue" onclick="saveNewGroup()">åˆ›å»ºåˆ†ç»„</button>
                <button class="btn btn-red" onclick="showGroups()">å–æ¶ˆè¿”å›</button>
            </div>
            
            <div id="group-result"></div>
        </div>
    `;
}

async function saveNewGroup() {
    const name = document.getElementById('group-name').value.trim();
    const desc = document.getElementById('group-desc').value.trim();
    
    if (!name) {
        showAlert('è¯·è¾“å…¥åˆ†ç»„åç§°', 'error');
        return;
    }
    
    try {
        const { data, error } = await supabase
            .from('word_groups')
            .insert([{
                name: name,
                description: desc,
                teacher_id: app.teacherId
            }])
            .select()
            .single();
        
        if (error) throw error;
        
        document.getElementById('group-result').innerHTML = `
            <div style="background: #D4EDDA; color: #155724; padding: 15px; border-radius: 8px;">
                âœ… åˆ†ç»„ "${name}" åˆ›å»ºæˆåŠŸï¼
            </div>
        `;
        
        setTimeout(() => showGroups(), 1500);
        
    } catch (error) {
        console.error('åˆ›å»ºåˆ†ç»„é”™è¯¯:', error);
        document.getElementById('group-result').innerHTML = `
            <div style="background: #F8D7DA; color: #721C24; padding: 15px; border-radius: 8px;">
                âŒ åˆ›å»ºå¤±è´¥ï¼š${error.message}
            </div>
        `;
    }
}

// ========== å­¦ç”ŸåŠŸèƒ½ ==========
async function loadStudentHome() {
    const content = document.getElementById('student-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                <h4 style="color: #333; margin-bottom: 15px;">ğŸ’¡ æ¬¢è¿ä½¿ç”¨</h4>
                <p style="color: #666; margin: 8px 0;">â€¢ ç‚¹å‡»"å¼€å§‹å­¦ä¹ "æŒ‰é’®å¼€å§‹å­¦ä¹ å•è¯</p>
                <p style="color: #666; margin: 8px 0;">â€¢ æŸ¥çœ‹"æˆ‘çš„å•è¯"äº†è§£å­¦ä¹ è¿›åº¦</p>
                <p style="color: #666; margin: 8px 0;">â€¢ æŸ¥çœ‹"æˆ‘çš„åˆ†ç»„"äº†è§£æ‰€åœ¨åˆ†ç»„</p>
            </div>
        </div>
    `;
}

function startLearning() {
    const content = document.getElementById('student-content');
    content.innerHTML = `
        <div style="text-align: center;">
            <h3 style="color: #333; margin-bottom: 10px;">ğŸ¯ å•è¯è®­ç»ƒ</h3>
            <p style="color: #666; margin-bottom: 5px;">ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹ä¸­æ–‡æ„æ€</p>
            
            <div style="background: white; border: 4px solid #4CAF50; border-radius: 20px; height: 200px; display: flex; align-items: center; justify-content: center; margin: 30px auto; cursor: pointer; font-size: 2em; font-weight: bold; max-width: 400px;"
                onclick="this.style.background='linear-gradient(135deg, #E8F5E9, #C8E6C9)'; this.innerHTML='ä½ å¥½<br><small style=\"color:#2E7D32;font-size:0.8em;\">hello</small>'">
                hello
            </div>
            
            <div style="margin: 35px 0;">
                <button class="btn" onclick="showAlert('æ ‡è®°ä¸ºå·²æŒæ¡ï¼', 'success')">
                    <span>âœ… å·²æŒæ¡</span>
                </button>
                <button class="btn btn-blue" onclick="showAlert('ç»§ç»­å­¦ä¹ ä¸­...', 'info')">
                    <span>ğŸ”„ å­¦ä¹ ä¸­</span>
                </button>
                <button class="btn" onclick="showAlert('å·²è·³è¿‡', 'info')">
                    <span>â­ï¸ è·³è¿‡</span>
                </button>
            </div>
            
            <button class="btn btn-red" onclick="loadStudentHome()">
                <span>ğŸ“‹ è¿”å›èœå•</span>
            </button>
        </div>
    `;
}

function showMyWords() {
    const content = document.getElementById('student-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ“– æˆ‘çš„å•è¯</h3>
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <p style="color: #666;">åŠŸèƒ½å¼€å‘ä¸­...</p>
                <p style="color: #666; margin-top: 10px;">è¿™é‡Œå°†æ˜¾ç¤ºæ‚¨çš„å­¦ä¹ è¿›åº¦å’Œå•è¯åˆ—è¡¨</p>
            </div>
            <button class="btn btn-red" onclick="loadStudentHome()">
                <span>ğŸ”™ è¿”å›ä¸»èœå•</span>
            </button>
        </div>
    `;
}

function showMyGroups() {
    const content = document.getElementById('student-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ‘¥ æˆ‘çš„åˆ†ç»„</h3>
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <p style="color: #666;">åŠŸèƒ½å¼€å‘ä¸­...</p>
                <p style="color: #666; margin-top: 10px;">è¿™é‡Œå°†æ˜¾ç¤ºæ‚¨æ‰€åœ¨çš„åˆ†ç»„ä¿¡æ¯</p>
            </div>
            <button class="btn btn-red" onclick="loadStudentHome()">
                <span>ğŸ”™ è¿”å›ä¸»èœå•</span>
            </button>
        </div>
    `;
}

// ç®€åŒ–ç‰ˆæœ¬çš„å…¶ä»–åŠŸèƒ½ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
function showGroupWords() {
    const content = document.getElementById('teacher-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ“ åˆ†ç»„å•è¯ç®¡ç†</h3>
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <p style="color: #666;">åŠŸèƒ½å¼€å‘ä¸­...</p>
                <p style="color: #666; margin-top: 10px;">è¿™é‡Œå°†æ˜¾ç¤ºä¸ºåˆ†ç»„æ·»åŠ å’Œç®¡ç†å•è¯çš„åŠŸèƒ½</p>
            </div>
            <button class="btn btn-red" onclick="loadTeacherHome()">
                <span>ğŸ”™ è¿”å›ä¸»èœå•</span>
            </button>
        </div>
    `;
}

function showAllStudents() {
    const content = document.getElementById('teacher-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ“ å­¦ç”Ÿç®¡ç†</h3>
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <p style="color: #666;">åŠŸèƒ½å¼€å‘ä¸­...</p>
                <p style="color: #666; margin-top: 10px;">è¿™é‡Œå°†æ˜¾ç¤ºå­¦ç”Ÿç®¡ç†å’Œåˆ†ç»„åˆ†é…åŠŸèƒ½</p>
            </div>
            <button class="btn btn-red" onclick="loadTeacherHome()">
                <span>ğŸ”™ è¿”å›ä¸»èœå•</span>
            </button>
        </div>
    `;
}

function manageGroupWords(groupId) {
    const content = document.getElementById('teacher-content');
    content.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <h3 style="color: #333; margin-bottom: 30px;">ğŸ“ ç®¡ç†åˆ†ç»„å•è¯</h3>
            <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <p style="color: #666;">åˆ†ç»„ID: ${groupId}</p>
                <p style="color: #666; margin-top: 10px;">è¿™é‡Œå°†æ˜¾ç¤ºä¸ºåˆ†ç»„æ·»åŠ å’Œç®¡ç†å•è¯çš„åŠŸèƒ½</p>
            </div>
            <button class="btn btn-red" onclick="showGroups()">
                <span>ğŸ”™ è¿”å›åˆ†ç»„åˆ—è¡¨</span>
            </button>
        </div>
    `;
}

// ========== è¿æ¥æµ‹è¯• ==========
async function testConnection() {
    updateConnectionStatus(null, 'æ­£åœ¨æµ‹è¯•è¿æ¥...');
    
    try {
        const { data, error } = await supabase.from('users').select('count').limit(1);
        
        if (error) {
            updateConnectionStatus(false, 'è¿æ¥å¤±è´¥ï¼š' + error.message);
            return;
        }
        
        updateConnectionStatus(true, 'âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼å¯ä»¥ç™»å½•äº†');
        
    } catch (error) {
        console.error('è¿æ¥æµ‹è¯•é”™è¯¯:', error);
        updateConnectionStatus(false, 'è¿æ¥å¤±è´¥ï¼š' + error.message);
    }
}

function handleLogout() {
    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        app.user = null;
        app.isTeacher = false;
        app.userId = null;
        
        localStorage.removeItem('kathy_user');
        localStorage.removeItem('kathy_role');
        
        showScreen('login-screen');
        document.getElementById('username').value = '';
        updateConnectionStatus(null, 'å·²é€€å‡ºç™»å½•ï¼Œè¯·è¾“å…¥ç”¨æˆ·åé‡æ–°ç™»å½•');
    }
}

// ========== é¡µé¢åˆå§‹åŒ– ==========
window.onload = async function() {
    console.log('ğŸš€ Kathyåˆ†ç»„å•è¯ç³»ç»Ÿå¯åŠ¨');
    
    // ç«‹å³æ›´æ–°çŠ¶æ€ï¼Œè®©ç”¨æˆ·çŸ¥é“ç³»ç»Ÿæ­£åœ¨åŠ è½½
    updateConnectionStatus(null, 'æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...');
    
    // æ£€æŸ¥è‡ªåŠ¨ç™»å½•
    const savedUser = localStorage.getItem('kathy_user');
    const savedRole = localStorage.getItem('kathy_role');
    
    if (savedUser) {
        try {
            const { error } = await supabase.from('users').select('count').limit(1);
            if (error) {
                updateConnectionStatus(false, 'è‡ªåŠ¨ç™»å½•å¤±è´¥ï¼š' + error.message);
                return;
            }
            
            app.user = savedUser;
            app.isTeacher = (savedRole === 'teacher');
            app.userId = savedUser;
            
            if (app.isTeacher) {
                showScreen('teacher-screen');
                loadTeacherHome();
                updateConnectionStatus(true, `âœ… è‡ªåŠ¨ç™»å½•æˆåŠŸï¼Œæ¬¢è¿ ${savedUser}ï¼`);
            } else {
                showScreen('student-screen');
                document.getElementById('student-welcome').textContent = `ğŸ“ æ¬¢è¿ï¼Œ${savedUser}ï¼`;
                loadStudentHome();
                updateConnectionStatus(true, `âœ… è‡ªåŠ¨ç™»å½•æˆåŠŸï¼Œæ¬¢è¿ ${savedUser}ï¼`);
            }
            
        } catch (error) {
            console.error('è‡ªåŠ¨ç™»å½•é”™è¯¯:', error);
            updateConnectionStatus(false, 'è‡ªåŠ¨ç™»å½•å¤±è´¥ï¼š' + error.message);
        }
    } else {
        // åˆå§‹è¿æ¥æµ‹è¯•
        setTimeout(testConnection, 500);
    }
    
    // ç»‘å®šå›è½¦é”®ç™»å½•
    const usernameInput = document.getElementById('username');
    if (usernameInput) {
        usernameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') handleLogin();
        });
    }
};
</script>
</body>
</html>
