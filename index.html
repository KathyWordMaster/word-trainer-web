<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
        }
        
        body { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
            padding: 20px; 
        }
        
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
            overflow: hidden; 
        }
        
        .header { 
            background: linear-gradient(135deg, #2C3E50 0%, #4A6491 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        
        .header h1 { 
            font-size: 2.2em; 
            margin-bottom: 10px; 
            color: #F1C40F; 
        }
        
        .main-content { 
            padding: 30px; 
        }
        
        /* é¡µé¢åˆ‡æ¢ */
        .screen { 
            display: none; 
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .screen.active { 
            display: block; 
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn { 
            background: #4CAF50; 
            color: white; 
            border: none; 
            padding: 14px 28px; 
            margin: 10px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover { 
            background: #45a049; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-blue { 
            background: #2196F3; 
        }
        
        .btn-blue:hover { 
            background: #1976D2; 
        }
        
        .btn-red { 
            background: #F44336; 
        }
        
        .btn-red:hover { 
            background: #D32F2F; 
        }
        
        .btn-purple { 
            background: #9C27B0; 
        }
        
        .btn-purple:hover { 
            background: #7B1FA2; 
        }
        
        .btn-gold { 
            background: #FFC107; 
            color: #333; 
        }
        
        .btn-gold:hover { 
            background: #FFA000; 
        }
        
        /* è¾“å…¥æ¡† */
        input[type="text"], 
        input[type="password"], 
        textarea {
            width: 100%;
            max-width: 400px;
            padding: 16px;
            margin: 12px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, 
        textarea:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        textarea {
            height: 200px;
            font-family: monospace;
            resize: vertical;
        }
        
        /* å•è¯å¡ç‰‡ */
        .word-card {
            background: white;
            border: 4px solid #4CAF50;
            border-radius: 20px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            cursor: pointer;
            font-size: 2.8em;
            font-weight: bold;
            transition: all 0.3s;
            max-width: 600px;
            position: relative;
            overflow: hidden;
        }
        
        .word-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .word-card.flipped {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            border-color: #2E7D32;
        }
        
        .card-front, .card-back {
            padding: 30px;
            text-align: center;
            width: 100%;
        }
        
        .card-back {
            color: #2E7D32;
            display: none;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #4CAF50;
        }
        
        /* è¡¨æ ¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .data-table th {
            background: #4CAF50;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        /* å¾®ä¿¡è”ç³»æ ·å¼ */
        .contact-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
            border: 2px dashed #4CAF50;
        }
        
        .wechat-badge {
            background: #07C160;
            color: white;
            padding: 14px 28px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-weight: bold;
            font-size: 1.1em;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(7, 193, 96, 0.3);
        }
        
        /* åŠŸèƒ½ç‰¹ç‚¹ */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .feature-item {
            background: #E3F2FD;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #90CAF9;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .word-card {
                height: 220px;
                font-size: 2.2em;
                margin: 20px 10px;
            }
            
            .btn {
                padding: 12px 20px;
                margin: 8px;
                font-size: 15px;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .status-remembered {
            background: #E8F5E9;
            color: #2E7D32;
        }
        
        .status-fuzzy {
            background: #FFF3E0;
            color: #EF6C00;
        }
        
        .status-forgot {
            background: #FFEBEE;
            color: #C62828;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æç¤ºä¿¡æ¯ */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
        }
        
        .alert-success {
            background: #E8F5E9;
            color: #2E7D32;
            border: 1px solid #C8E6C9;
        }
        
        .alert-error {
            background: #FFEBEE;
            color: #C62828;
            border: 1px solid #FFCDD2;
        }
        
        .alert-info {
            background: #E3F2FD;
            color: #1565C0;
            border: 1px solid #BBDEFB;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
        <div class="header">
            <h1>âš¡ Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥</h1>
            <h2 style="color: white; margin-bottom: 10px;">å¿«æ¥èƒŒå•è¯ï¼</h2>
            <p style="color: #BDC3C7; font-size: 0.95em;">æ™ºèƒ½è®°å¿† Â· æ•™å¸ˆç›‘æ§ Â· é«˜æ•ˆå­¦ä¹ </p>
        </div>
        
        <div class="main-content">
            <!-- ========== ç™»å½•ç•Œé¢ ========== -->
            <div id="login-screen" class="screen active">
                <div style="text-align: center;">
                    <h2>ğŸ¯ å¼€å§‹ä½ çš„å•è¯ä¹‹æ—…</h2>
                    <p style="color: #666; margin-bottom: 30px;">å­¦ç”Ÿæ³¨å†Œå³å¯å¼€å§‹ï¼Œæ•™å¸ˆä½¿ç”¨ä¸“å±è´¦å·</p>
                    
                    <div style="margin: 30px 0;">
                        <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" autofocus>
                        
                        <div style="margin: 25px 0;">
                            <button class="btn" onclick="login()">
                                <span>ğŸ”‘ ç™»å½•</span>
                            </button>
                            <button class="btn btn-blue" onclick="register()">
                                <span>ğŸ“ æ–°ç”¨æˆ·æ³¨å†Œ</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½ç‰¹ç‚¹å±•ç¤º -->
                    <div class="features-grid">
                        <div class="feature-item">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ“š</div>
                            <div style="font-weight: bold; color: #1565C0;">æ™ºèƒ½é—ªå¡</div>
                            <div style="font-size: 0.9em; color: #666;">ç§‘å­¦è®°å¿†æ³•</div>
                        </div>
                        <div class="feature-item">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ“ˆ</div>
                            <div style="font-weight: bold; color: #1565C0;">è¿›åº¦è¿½è¸ª</div>
                            <div style="font-size: 0.9em; color: #666;">å®æ—¶æŒæ¡è¿›åº¦</div>
                        </div>
                        <div class="feature-item">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ‘¥</div>
                            <div style="font-weight: bold; color: #1565C0;">å¤šç”¨æˆ·</div>
                            <div style="font-size: 0.9em; color: #666;">æ”¯æŒç­çº§å­¦ä¹ </div>
                        </div>
                        <div class="feature-item">
                            <div style="font-size: 1.5em; margin-bottom: 8px;">ğŸ‘‘</div>
                            <div style="font-weight: bold; color: #1565C0;">æ•™å¸ˆç›‘ç®¡</div>
                            <div style="font-size: 0.9em; color: #666;">å®æ—¶ç›‘æ§è¿›åº¦</div>
                        </div>
                    </div>
                    
                    <!-- è”ç³»ä¿¡æ¯ -->
                    <div class="contact-section">
                        <h3 style="color: #2C3E50; margin-bottom: 20px;">ğŸ’¬ è”ç³»æˆ‘ä»¬</h3>
                        <div class="wechat-badge">
                            <span>å¾®ä¿¡è”ç³»ï¼š</span>
                            <strong>Kathy151</strong>
                        </div>
                        <p style="color: #555; margin-top: 15px; font-size: 0.95em;">
                            å­¦ç”Ÿæ³¨å†Œå³å¯ä½¿ç”¨ï¼Œæ•™å¸ˆè´¦å·ï¼škathy151
                        </p>
                        <p style="color: #777; margin-top: 10px; font-size: 0.85em;">
                            æœ‰ä»»ä½•é—®é¢˜éšæ—¶è”ç³»è€å¸ˆ
                        </p>
                    </div>
                    
                    <!-- è°ƒè¯•ä¿¡æ¯ -->
                    <div id="login-status" class="alert" style="display: none;"></div>
                </div>
            </div>
            
            <!-- ========== ä¸»èœå• ========== -->
            <div id="menu-screen" class="screen">
                <h2 id="welcome-message" style="text-align: center; margin-bottom: 30px;"></h2>
                
                <!-- æ•™å¸ˆé¢æ¿ -->
                <div id="teacher-panel" class="stats-card" style="display: none;">
                    <h3 style="color: #9C27B0; margin-bottom: 20px;">ğŸ‘‘ æ•™å¸ˆç®¡ç†é¢æ¿</h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        <span style="font-weight: bold;">æ•™å¸ˆï¼š</span>Kathyè€å¸ˆ
                        <span style="margin: 0 15px;">|</span>
                        <span style="font-weight: bold;">å¾®ä¿¡ï¼š</span>Kathy151
                    </p>
                    
                    <div style="margin: 25px 0;">
                        <button class="btn btn-purple" onclick="showStudentStats()">
                            <span>ğŸ“Š æŸ¥çœ‹å­¦ç”Ÿå­¦ä¹ æƒ…å†µ</span>
                        </button>
                        <button class="btn btn-blue" onclick="showAllStudents()">
                            <span>ğŸ‘¥ ç®¡ç†å­¦ç”Ÿ</span>
                        </button>
                    </div>
                    
                    <div class="alert alert-info">
                        <p>ğŸ’¡ æ‚¨å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å­¦ç”Ÿçš„å­¦ä¹ è¿›åº¦ã€æ·»åŠ çš„å•è¯å’ŒæŒæ¡æƒ…å†µ</p>
                    </div>
                </div>
                
                <!-- å­¦ç”Ÿé¢æ¿ -->
                <div id="student-panel" class="stats-card" style="display: none;">
                    <h3 style="color: #2196F3; margin-bottom: 20px;">ğŸ“ æˆ‘çš„å­¦ä¹ ä¸­å¿ƒ</h3>
                    
                    <!-- å­¦ä¹ ç»Ÿè®¡ -->
                    <div id="learning-stats">
                        <div class="loader"></div>
                    </div>
                    
                    <!-- å¿«é€Ÿæ“ä½œ -->
                    <div style="margin: 30px 0;">
                        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;">
                            <button class="btn" onclick="showAddWords()">
                                <span>ğŸ“ æ‰¹é‡æ·»åŠ å•è¯</span>
                            </button>
                            <button class="btn btn-blue" onclick="startTraining()">
                                <span>ğŸ¯ å¼€å§‹è®­ç»ƒ</span>
                            </button>
                            <button class="btn" onclick="showMyWords()">
                                <span>ğŸ“– æˆ‘çš„å•è¯åº“</span>
                            </button>
                            <button class="btn btn-gold" onclick="showReviewWords()">
                                <span>ğŸ”„ å¤ä¹ å¼±é¡¹</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ä»Šæ—¥ç›®æ ‡ -->
                    <div style="background: #FFF3E0; padding: 20px; border-radius: 10px; margin: 20px 0;">
                        <h4 style="color: #EF6C00; margin-bottom: 10px;">ğŸ¯ ä»Šæ—¥å­¦ä¹ ç›®æ ‡</h4>
                        <p style="color: #666;">å»ºè®®æ¯å¤©å­¦ä¹  <strong>20ä¸ª</strong> æ–°å•è¯ï¼Œå¤ä¹  <strong>50ä¸ª</strong> æ—§å•è¯</p>
                        <div class="progress-bar" style="margin: 15px 0;">
                            <div id="daily-progress" class="progress-fill" style="width: 30%;"></div>
                        </div>
                        <p style="color: #666; font-size: 0.9em;">ä»Šæ—¥è¿›åº¦ï¼š30%</p>
                    </div>
                </div>
                
                <!-- é€šç”¨åŠŸèƒ½ -->
                <div style="text-align: center; margin-top: 40px;">
                    <div style="margin-bottom: 20px;">
                        <button class="btn" onclick="showSettings()">
                            <span>âš™ï¸ ç³»ç»Ÿè®¾ç½®</span>
                        </button>
                        <button class="btn btn-red" onclick="logout()">
                            <span>ğŸšª é€€å‡ºç™»å½•</span>
                        </button>
                    </div>
                    
                    <!-- è”ç³»ä¿¡æ¯ -->
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; display: inline-block;">
                        <p style="color: #666; margin: 0;">
                            ğŸ’¬ éœ€è¦å¸®åŠ©ï¼Ÿå¾®ä¿¡è”ç³»ï¼š<strong>Kathy151</strong>
                        </p>
                    </div>
                </div>
                
                <!-- æ“ä½œåé¦ˆ -->
                <div id="menu-feedback" class="alert" style="display: none; margin-top: 20px;"></div>
            </div>
            
            <!-- ========== å•è¯è®­ç»ƒç•Œé¢ ========== -->
            <div id="train-screen" class="screen">
                <div style="text-align: center;">
                    <h2 style="margin-bottom: 10px;">ğŸ¯ å•è¯è®­ç»ƒ</h2>
                    <p style="color: #666; margin-bottom: 25px;">ç‚¹å‡»å¡ç‰‡ç¿»è½¬ï¼Œæ ¹æ®è®°å¿†ç¨‹åº¦é€‰æ‹©æŒ‰é’®</p>
                    
                    <!-- è®­ç»ƒæ§åˆ¶ -->
                    <div style="margin-bottom: 30px;">
                        <div class="progress-container">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span id="progress-text" style="color: #666;">è¿›åº¦: 0/0</span>
                                <span id="mode-text" style="color: #2196F3; font-weight: bold;">è‹±æ–‡ â†’ ä¸­æ–‡</span>
                            </div>
                            <div class="progress-bar">
                                <div id="train-progress" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div style="margin: 20px 0;">
                            <button class="btn btn-gold" onclick="toggleTrainingMode()" style="padding: 10px 20px; font-size: 14px;">
                                <span>ğŸ”„ åˆ‡æ¢è®­ç»ƒæ¨¡å¼</span>
                            </button>
                            <button class="btn" onclick="shuffleWords()" style="padding: 10px 20px; font-size: 14px;">
                                <span>ğŸ² é‡æ–°æ´—ç‰Œ</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- å•è¯å¡ç‰‡ -->
                    <div id="word-card" class="word-card" onclick="flipCard()">
                        <div id="card-front" class="card-front">ç‚¹å‡»å¼€å§‹è®­ç»ƒ</div>
                        <div id="card-back" class="card-back"></div>
                    </div>
                    
                    <!-- è®°å¿†æŒ‰é’® -->
                    <div style="margin: 35px 0;">
                        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;">
                            <button class="btn" onclick="markWord('remembered')" style="padding: 16px 32px; font-size: 17px;">
                                <span>âœ… è®°å¾—</span>
                            </button>
                            <button class="btn btn-blue" onclick="markWord('fuzzy')" style="padding: 16px 32px; font-size: 17px;">
                                <span>ğŸ”„ æ¨¡ç³Š</span>
                            </button>
                            <button class="btn btn-red" onclick="markWord('forgot')" style="padding: 16px 32px; font-size: 17px;">
                                <span>âŒ å¿˜è®°</span>
                            </button>
                            <button class="btn" onclick="skipWord()" style="padding: 16px 32px; font-size: 17px;">
                                <span>â­ï¸ è·³è¿‡</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- è®­ç»ƒç»Ÿè®¡ -->
                    <div id="train-stats" style="margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; display: none;">
                        <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; color: #4CAF50; font-weight: bold;" id="stats-remembered">0</div>
                                <div style="color: #666; font-size: 0.9em;">è®°å¾—</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; color: #FF9800; font-weight: bold;" id="stats-fuzzy">0</div>
                                <div style="color: #666; font-size: 0.9em;">æ¨¡ç³Š</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; color: #F44336; font-weight: bold;" id="stats-forgot">0</div>
                                <div style="color: #666; font-size: 0.9em;">å¿˜è®°</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.8em; color: #2196F3; font-weight: bold;" id="stats-total">0</div>
                                <div style="color: #666; font-size: 0.9em;">æ€»æ•°</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div style="margin-top: 30px;">
                        <button class="btn btn-red" onclick="endTraining()">
                            <span>ğŸ ç»“æŸè®­ç»ƒ</span>
                        </button>
                        <button class="btn" onclick="showMenu()">
                            <span>ğŸ“‹ è¿”å›èœå•</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ========== æ‰¹é‡æ·»åŠ å•è¯ ========== -->
            <div id="add-screen" class="screen">
                <div style="max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“ æ‰¹é‡æ·»åŠ å•è¯</h2>
                    
                    <div class="alert alert-info" style="margin-bottom: 25px;">
                        <p><strong>ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š</strong></p>
                        <p>æ¯è¡Œä¸€ä¸ªå•è¯ï¼Œè‹±æ–‡å’Œä¸­æ–‡ç”¨ç©ºæ ¼ã€å†’å·(:)æˆ–ç­‰å·(=)åˆ†éš”</p>
                        <p><strong>ç¤ºä¾‹ï¼š</strong> hello ä½ å¥½ æˆ– apple:è‹¹æœ æˆ– world=ä¸–ç•Œ</p>
                    </div>
                    
                    <div style="margin-bottom: 25px;">
                        <textarea id="word-input" placeholder="åœ¨è¿™é‡Œç²˜è´´æˆ–è¾“å…¥å•è¯...
ç¤ºä¾‹ï¼š
hello ä½ å¥½
world ä¸–ç•Œ
apple è‹¹æœ
book ä¹¦
computer ç”µè„‘"></textarea>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <button class="btn" onclick="importWords()">
                            <span>ğŸ“¥ å¯¼å…¥å•è¯</span>
                        </button>
                        <button class="btn btn-blue" onclick="pasteFromClipboard()">
                            <span>ğŸ“‹ ç²˜è´´å†…å®¹</span>
                        </button>
                        <button class="btn" onclick="loadExampleWords()">
                            <span>ğŸ“š åŠ è½½ç¤ºä¾‹</span>
                        </button>
                        <button class="btn btn-red" onclick="showMenu()">
                            <span>ğŸ”™ è¿”å›</span>
                        </button>
                    </div>
                    
                    <!-- å¯¼å…¥ç»“æœ -->
                    <div id="import-result" class="alert" style="display: none;"></div>
                    
                    <!-- å½“å‰å•è¯ç»Ÿè®¡ -->
                    <div id="word-count-info" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <h4 style="color: #333; margin-bottom: 15px;">ğŸ“Š å•è¯ç»Ÿè®¡</h4>
                        <div style="display: flex; justify-content: space-around; flex-wrap: wrap;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.5em; color: #2196F3; font-weight: bold;" id="total-words">0</div>
                                <div style="color: #666; font-size: 0.9em;">å•è¯æ€»æ•°</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5em; color: #4CAF50; font-weight: bold;" id="new-words">0</div>
                                <div style="color: #666; font-size: 0.9em;">æ–°å•è¯</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.5em; color: #FF9800; font-weight: bold;" id="duplicate-words">0</div>
                                <div style="color: #666; font-size: 0.9em;">é‡å¤å•è¯</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ========== æˆ‘çš„å•è¯åº“ ========== -->
            <div id="words-screen" class="screen">
                <div style="max-width: 900px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 25px;">ğŸ“– æˆ‘çš„å•è¯åº“</h2>
                    
                    <!-- æœç´¢å’Œç­›é€‰ -->
                    <div style="margin-bottom: 30px;">
                        <div style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-bottom: 20px;">
                            <input type="text" id="word-search" placeholder="ğŸ” æœç´¢å•è¯..." 
                                   style="flex: 1; min-width: 250px; max-width: 400px;">
                            <select id="word-filter" style="padding: 12px; border-radius: 8px; border: 2px solid #ddd;">
                                <option value="all">å…¨éƒ¨å•è¯</option>
                                <option value="remembered">âœ… è®°å¾—çš„</option>
                                <option value="fuzzy">ğŸ”„ æ¨¡ç³Šçš„</option>
                                <option value="forgot">âŒ å¿˜è®°çš„</option>
                                <option value="new">ğŸ†• æœªå­¦ä¹ çš„</option>
                            </select>
                            <button class="btn" onclick="filterWords()" style="padding: 12px 24px;">
                                <span>ç­›é€‰</span>
                            </button>
                        </div>
                        
                        <div style="text-align: center; color: #666; margin-bottom: 20px;">
                            <p>æ‰¾åˆ° <span id="filtered-count" style="font-weight: bold; color: #2196F3;">0</span> ä¸ªå•è¯</p>
                        </div>
                    </div>
                    
                    <!-- å•è¯åˆ—è¡¨ -->
                    <div id="words-list-container">
                        <div class="loader"></div>
                    </div>
                    
                    <!-- æ“ä½œæŒ‰é’® -->
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn" onclick="exportWords()">
                            <span>ğŸ“¤ å¯¼å‡ºå•è¯</span>
                        </button>
                        <button class="btn btn-red" onclick="showMenu()">
                            <span>ğŸ”™ è¿”å›</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ========== è®¾ç½®ç•Œé¢ ========== -->
            <div id="settings-screen" class="screen">
                <div style="max-width: 700px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 30px;">âš™ï¸ ç³»ç»Ÿè®¾ç½®</h2>
                    
                    <div class="stats-card">
                        <h3 style="color: #333; margin-bottom: 20px;">ğŸ¯ è®­ç»ƒè®¾ç½®</h3>
                        
                        <div style="margin: 20px 0;">
                            <label style="display: block; margin: 15px 0; cursor: pointer;">
                                <input type="checkbox" id="auto-flip" checked style="margin-right: 10px;">
                                <span style="font-weight: bold;">è‡ªåŠ¨ç¿»ç‰Œ</span>
                                <span style="color: #666; display: block; margin-top: 5px;">æ˜¾ç¤ºå•è¯å3ç§’è‡ªåŠ¨æ˜¾ç¤ºç¿»è¯‘</span>
                            </label>
                            
                            <label style="display: block; margin: 15px 0; cursor: pointer;">
                                <input type="checkbox" id="sound-effects" checked style="margin-right: 10px;">
                                <span style="font-weight: bold;">éŸ³æ•ˆæç¤º</span>
                                <span style="color: #666; display: block; margin-top: 5px;">æ“ä½œæ—¶æ’­æ”¾æç¤ºéŸ³</span>
                            </label>
                            
                            <label style="display: block; margin: 15px 0; cursor: pointer;">
                                <input type="checkbox" id="daily-reminder" checked style="margin-right: 10px;">
                                <span style="font-weight: bold;">æ¯æ—¥æé†’</span>
                                <span style="color: #666; display: block; margin-top: 5px;">æ¯å¤©æé†’å­¦ä¹ å•è¯</span>
                            </label>
                        </div>
                        
                        <div style="margin: 25px 0;">
                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">æ¯è½®è®­ç»ƒå•è¯æ•°é‡</label>
                            <select id="words-per-session" style="padding: 12px; width: 100%; border-radius: 8px; border: 2px solid #ddd;">
                                <option value="10">10ä¸ªå•è¯</option>
                                <option value="20" selected>20ä¸ªå•è¯</option>
                                <option value="30">30ä¸ªå•è¯</option>
                                <option value="50">50ä¸ªå•è¯</option>
                                <option value="100">100ä¸ªå•è¯</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <h3 style="color: #333; margin-bottom: 20px;">ğŸ“ è”ç³»ä¿¡æ¯</h3>
                        
                        <div style="text-align: center; margin: 25px 0;">
                            <div class="wechat-badge" style="margin: 0 auto 20px;">
                                <span>å¾®ä¿¡è”ç³»ï¼š</span>
                                <strong>Kathy151</strong>
                            </div>
                            
                            <p style="color: #666; margin-bottom: 15px;">
                                <strong>ğŸ‘©â€ğŸ« æ•™å¸ˆï¼š</strong>Kathyè€å¸ˆ
                            </p>
                            <p style="color: #666;">
                                å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·éšæ—¶è”ç³»è€å¸ˆã€‚
                            </p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 40px;">
                        <button class="btn btn-blue" onclick="saveSettings()">
                            <span>ğŸ’¾ ä¿å­˜è®¾ç½®</span>
                        </button>
                        <button class="btn btn-red" onclick="showMenu()">
                            <span>ğŸ”™ è¿”å›</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== å…¨å±€å˜é‡å’Œé…ç½® ==========
        const CONFIG = {
            supabaseUrl: 'https://lctdyhtydcqhloibogyj.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxjdGR5aHR5ZGNxaGxvaWJvZ3lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4MTM1NTksImV4cCI6MjA4NDM4OTU1OX0.enKrwAeSpQ1QHIUZbU-2rTdDI-ALLXkq3YCdvvQO3lM',
            teacherUsername: 'kathy151'
        };
        
        // åº”ç”¨çŠ¶æ€
        let appState = {
            currentUser: null,
            isTeacher: false,
            userWords: [],
            trainingWords: [],
            currentWordIndex: 0,
            trainingMode: 'en_to_cn', // en_to_cn æˆ– cn_to_en
            cardFlipped: false,
            trainingStats: {
                remembered: 0,
                fuzzy: 0,
                forgot: 0
            }
        };
        
        // åˆå§‹åŒ–Supabase
        let supabase = null;
        
        // ========== å·¥å…·å‡½æ•° ==========
        function showAlert(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `alert alert-${type}`;
                element.innerHTML = message;
                element.style.display = 'block';
                
                if (type !== 'error') {
                    setTimeout(() => {
                        element.style.display = 'none';
                    }, 3000);
                }
            }
        }
        
        function showScreen(screenId) {
            // éšè—æ‰€æœ‰ç•Œé¢
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡ç•Œé¢
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                console.log(`åˆ‡æ¢åˆ°ç•Œé¢: ${screenId}`);
                
                // ç•Œé¢ç‰¹å®šåˆå§‹åŒ–
                switch(screenId) {
                    case 'menu-screen':
                        updateMenu();
                        break;
                    case 'words-screen':
                        loadWordsList();
                        break;
                    case 'train-screen':
                        updateTrainingStats();
                        break;
                }
            }
        }
        
        function showMenu() {
            showScreen('menu-screen');
        }
        
        function showLogin() {
            showScreen('login-screen');
        }
        
        // ========== ç”¨æˆ·è®¤è¯åŠŸèƒ½ ==========
        async function login() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                showAlert('login-status', 'è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            showAlert('login-status', 'ğŸ”„ æ­£åœ¨ç™»å½•...', 'info');
            
            try {
                appState.currentUser = username;
                appState.isTeacher = (username === CONFIG.teacherUsername);
                
                if (appState.isTeacher) {
                    // æ•™å¸ˆç™»å½•
                    localStorage.setItem('word_trainer_user', username);
                    showAlert('login-status', 'âœ… æ•™å¸ˆç™»å½•æˆåŠŸï¼', 'success');
                    showMenu();
                } else {
                    // å­¦ç”Ÿç™»å½•
                    // å°è¯•ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ•°æ®
                    const savedData = localStorage.getItem(`user_words_${username}`);
                    if (savedData) {
                        appState.userWords = JSON.parse(savedData);
                    }
                    
                    localStorage.setItem('word_trainer_user', username);
                    showAlert('login-status', 'âœ… ç™»å½•æˆåŠŸï¼', 'success');
                    showMenu();
                }
                
            } catch (error) {
                console.error('ç™»å½•å¤±è´¥:', error);
                showAlert('login-status', `âŒ ç™»å½•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function register() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                showAlert('login-status', 'è¯·è¾“å…¥ç”¨æˆ·å', 'error');
                return;
            }
            
            if (username.length < 2) {
                showAlert('login-status', 'ç”¨æˆ·åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦', 'error');
                return;
            }
            
            if (username.toLowerCase() === CONFIG.teacherUsername.toLowerCase()) {
                showAlert('login-status', 'è¯¥ç”¨æˆ·åä¸å¯ç”¨', 'error');
                return;
            }
            
            showAlert('login-status', 'ğŸ”„ æ­£åœ¨åˆ›å»ºç”¨æˆ·...', 'info');
            
            try {
                appState.currentUser = username;
                appState.isTeacher = false;
                appState.userWords = [];
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('word_trainer_user', username);
                localStorage.setItem(`user_words_${username}`, JSON.stringify([]));
                
                showAlert('login-status', 'âœ… æ³¨å†ŒæˆåŠŸï¼', 'success');
                
                // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
                setTimeout(() => {
                    alert(`ğŸ‰ æ¬¢è¿ ${username} åŠ å…¥Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥ï¼\n\nå¼€å§‹ä½ çš„å•è¯å­¦ä¹ ä¹‹æ—…å§ï¼`);
                    showMenu();
                }, 500);
                
            } catch (error) {
                console.error('æ³¨å†Œå¤±è´¥:', error);
                showAlert('login-status', `âŒ æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function updateMenu() {
            const welcomeMsg = document.getElementById('welcome-message');
            const teacherPanel = document.getElementById('teacher-panel');
            const studentPanel = document.getElementById('student-panel');
            const learningStats = document.getElementById('learning-stats');
            
            if (appState.isTeacher) {
                welcomeMsg.textContent = `ğŸ‘‘ æ¬¢è¿ï¼ŒKathyè€å¸ˆï¼`;
                teacherPanel.style.display = 'block';
                studentPanel.style.display = 'none';
            } else {
                welcomeMsg.textContent = `ğŸ“ æ¬¢è¿ï¼Œ${appState.currentUser}ï¼`;
                teacherPanel.style.display = 'none';
                studentPanel.style.display = 'block';
                
                // æ›´æ–°å­¦ä¹ ç»Ÿè®¡
                updateLearningStats(learningStats);
            }
        }
        
        function updateLearningStats(element) {
            if (!element) return;
            
            const totalWords = appState.userWords.length;
            const remembered = appState.userWords.filter(w => w.status === 'remembered').length;
            const fuzzy = appState.userWords.filter(w => w.status === 'fuzzy').length;
            const forgot = appState.userWords.filter(w => w.status === 'forgot' || !w.status).length;
            const progress = totalWords > 0 ? Math.round((remembered / totalWords) * 100) : 0;
            
            element.innerHTML = `
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; margin: 20px 0;">
                    <div style="text-align: center; margin: 10px;">
                        <div style="font-size: 2em; color: #2196F3; font-weight: bold;">${totalWords}</div>
                        <div style="color: #666; font-size: 0.9em;">å•è¯æ€»æ•°</div>
                    </div>
                    <div style="text-align: center; margin: 10px;">
                        <div style="font-size: 2em; color: #4CAF50; font-weight: bold;">${remembered}</div>
                        <div style="color: #666; font-size: 0.9em;">å·²æŒæ¡</div>
                    </div>
                    <div style="text-align: center; margin: 10px;">
                        <div style="font-size: 2em; color: #FF9800; font-weight: bold;">${fuzzy}</div>
                        <div style="color: #666; font-size: 0.9em;">å­¦ä¹ ä¸­</div>
                    </div>
                    <div style="text-align: center; margin: 10px;">
                        <div style="font-size: 2em; color: #F44336; font-weight: bold;">${forgot}</div>
                        <div style="color: #666; font-size: 0.9em;">éœ€å¤ä¹ </div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #666;">æŒæ¡è¿›åº¦</span>
                        <span style="color: #4CAF50; font-weight: bold;">${progress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                </div>
            `;
        }
        
        // ========== å•è¯è®­ç»ƒåŠŸèƒ½ ==========
        function startTraining() {
            if (appState.userWords.length === 0) {
                alert('è¯·å…ˆæ·»åŠ å•è¯ï¼Œç„¶åå¼€å§‹è®­ç»ƒ');
                return;
            }
            
            // å‡†å¤‡è®­ç»ƒå•è¯
            appState.trainingWords = [...appState.userWords];
            
            // ä¼˜å…ˆè®­ç»ƒä¸ç†Ÿæ‚‰çš„å•è¯
            appState.trainingWords.sort((a, b) => {
                const statusOrder = { 'forgot': 0, '': 1, 'fuzzy': 2, 'remembered': 3 };
                return statusOrder[a.status || ''] - statusOrder[b.status || ''];
            });
            
            appState.currentWordIndex = 0;
            appState.trainingMode = 'en_to_cn';
            appState.cardFlipped = false;
            appState.trainingStats = { remembered: 0, fuzzy: 0, forgot: 0 };
            
            showScreen('train-screen');
            showCurrentWord();
        }
        
        function showCurrentWord() {
            if (appState.currentWordIndex >= appState.trainingWords.length) {
                // è®­ç»ƒå®Œæˆ
                endTraining();
                return;
            }
            
            const word = appState.trainingWords[appState.currentWordIndex];
            const cardFront = document.getElementById('card-front');
            const cardBack = document.getElementById('card-back');
            const wordCard = document.getElementById('word-card');
            
            // é‡ç½®å¡ç‰‡çŠ¶æ€
            wordCard.classList.remove('flipped');
            appState.cardFlipped = false;
            cardBack.style.display = 'none';
            
            // æ ¹æ®è®­ç»ƒæ¨¡å¼æ˜¾ç¤ºå†…å®¹
            if (appState.trainingMode === 'en_to_cn') {
                cardFront.textContent = word.english;
                cardBack.textContent = word.chinese;
                document.getElementById('mode-text').textContent = 'è‹±æ–‡ â†’ ä¸­æ–‡';
            } else {
                cardFront.textContent = word.chinese;
                cardBack.textContent = word.english;
                document.getElementById('mode-text').textContent = 'ä¸­æ–‡ â†’ è‹±æ–‡';
            }
            
            // æ›´æ–°è¿›åº¦
            const progress = ((appState.currentWordIndex + 1) / appState.trainingWords.length) * 100;
            document.getElementById('progress-text').textContent = 
                `è¿›åº¦: ${appState.currentWordIndex + 1}/${appState.trainingWords.length}`;
            document.getElementById('train-progress').style.width = `${progress}%`;
            
            // æ˜¾ç¤ºè®­ç»ƒç»Ÿè®¡
            updateTrainingStats();
        }
        
        function flipCard() {
            if (appState.currentWordIndex >= appState.trainingWords.length) return;
            
            const cardBack = document.getElementById('card-back');
            const wordCard = document.getElementById('word-card');
            
            if (!appState.cardFlipped) {
                cardBack.style.display = 'block';
                wordCard.classList.add('flipped');
                appState.cardFlipped = true;
            } else {
                cardBack.style.display = 'none';
                wordCard.classList.remove('flipped');
                appState.cardFlipped = false;
            }
        }
        
        function toggleTrainingMode() {
            appState.trainingMode = appState.trainingMode === 'en_to_cn' ? 'cn_to_en' : 'en_to_cn';
            appState.cardFlipped = false;
            showCurrentWord();
        }
        
        function shuffleWords() {
            // éšæœºæ‰“ä¹±å‰©ä½™å•è¯
            const remainingWords = appState.trainingWords.slice(appState.currentWordIndex);
            for (let i = remainingWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [remainingWords[i], remainingWords[j]] = [remainingWords[j], remainingWords[i]];
            }
            
            appState.trainingWords = [
                ...appState.trainingWords.slice(0, appState.currentWordIndex),
                ...remainingWords
            ];
            
            showCurrentWord();
            showAlert('menu-feedback', 'ğŸ² å•è¯é¡ºåºå·²é‡æ–°æ‰“ä¹±', 'success');
        }
        
        function markWord(status) {
            if (appState.currentWordIndex >= appState.trainingWords.length) return;
            
            const word = appState.trainingWords[appState.currentWordIndex];
            
            // æ›´æ–°å•è¯çŠ¶æ€
            word.status = status;
            word.reviewCount = (word.reviewCount || 0) + 1;
            word.lastReview = new Date().toISOString();
            
            // æ›´æ–°ç»Ÿè®¡
            appState.trainingStats[status]++;
            
            // æ›´æ–°åŸå§‹æ•°æ®
            const index = appState.userWords.findIndex(w => w.english === word.english);
            if (index !== -1) {
                appState.userWords[index] = word;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveUserData();
            
            // ä¸‹ä¸€ä¸ªå•è¯
            appState.currentWordIndex++;
            appState.cardFlipped = false;
            
            // çŸ­æš‚å»¶è¿Ÿåæ˜¾ç¤ºä¸‹ä¸€ä¸ªå•è¯
            setTimeout(showCurrentWord, 300);
        }
        
        function skipWord() {
            appState.currentWordIndex++;
            appState.cardFlipped = false;
            showCurrentWord();
        }
        
        function updateTrainingStats() {
            const statsDiv = document.getElementById('train-stats');
            if (statsDiv) {
                statsDiv.style.display = 'block';
                document.getElementById('stats-remembered').textContent = appState.trainingStats.remembered;
                document.getElementById('stats-fuzzy').textContent = appState.trainingStats.fuzzy;
                document.getElementById('stats-forgot').textContent = appState.trainingStats.forgot;
                document.getElementById('stats-total').textContent = appState.trainingWords.length;
            }
        }
        
        function endTraining() {
            const remembered = appState.trainingStats.remembered;
            const total = appState.trainingWords.length;
            const score = total > 0 ? Math.round((remembered / total) * 100) : 0;
            
            let message = `ğŸ‰ è®­ç»ƒå®Œæˆï¼\n\n`;
            message += `ğŸ“Š è®­ç»ƒç»Ÿè®¡ï¼š\n`;
            message += `âœ… è®°å¾—ï¼š${appState.trainingStats.remembered}\n`;
            message += `ğŸ”„ æ¨¡ç³Šï¼š${appState.trainingStats.fuzzy}\n`;
            message += `âŒ å¿˜è®°ï¼š${appState.trainingStats.forgot}\n`;
            message += `ğŸ“ˆ æŒæ¡ç‡ï¼š${score}%\n\n`;
            
            if (score >= 80) {
                message += `ğŸŒŸ å¤ªæ£’äº†ï¼ç»§ç»­ä¿æŒï¼`;
            } else if (score >= 60) {
                message += `ğŸ’ª è¿˜ä¸é”™ï¼Œç»§ç»­åŠ æ²¹ï¼`;
            } else {
                message += `ğŸ“š éœ€è¦å¤šå¤ä¹ ï¼Œç»§ç»­åŠªåŠ›ï¼`;
            }
            
            alert(message);
            showMenu();
        }
        
        // ========== å•è¯ç®¡ç†åŠŸèƒ½ ==========
        function showAddWords() {
            updateWordCount();
            showScreen('add-screen');
        }
        
        function pasteFromClipboard() {
            if (navigator.clipboard) {
                navigator.clipboard.readText()
                    .then(text => {
                        document.getElementById('word-input').value = text;
                    })
                    .catch(err => {
                        alert('æ— æ³•è®¿é—®å‰ªè´´æ¿ï¼Œè¯·æ‰‹åŠ¨ç²˜è´´');
                    });
            } else {
                alert('æµè§ˆå™¨ä¸æ”¯æŒå‰ªè´´æ¿è®¿é—®');
            }
        }
        
        function loadExampleWords() {
            const examples = `hello ä½ å¥½
world ä¸–ç•Œ
apple è‹¹æœ
book ä¹¦
computer ç”µè„‘
water æ°´
friend æœ‹å‹
school å­¦æ ¡
teacher è€å¸ˆ
student å­¦ç”Ÿ`;
            
            document.getElementById('word-input').value = examples;
            showAlert('import-result', 'ğŸ“š å·²åŠ è½½ç¤ºä¾‹å•è¯', 'success');
        }
        
        function importWords() {
            const input = document.getElementById('word-input').value.trim();
            
            if (!input) {
                showAlert('import-result', 'è¯·è¾“å…¥å•è¯', 'error');
                return;
            }
            
            const lines = input.split('\n');
            let added = 0;
            let duplicates = 0;
            let errors = [];
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;
                
                // è§£æå•è¯ï¼ˆæ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼‰
                let english = '', chinese = '';
                const separators = [' ', ':', '=', ',', 'ï¼š', 'ï¼Œ'];
                
                for (const sep of separators) {
                    if (trimmed.includes(sep)) {
                        const parts = trimmed.split(sep);
                        if (parts.length >= 2) {
                            english = parts[0].trim();
                            chinese = parts.slice(1).join(sep).trim();
                            break;
                        }
                    }
                }
                
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ†éš”ç¬¦ï¼Œå°è¯•æŒ‰ç©ºæ ¼åˆ†å‰²
                if (!english && !chinese) {
                    const parts = trimmed.split(/\s+/);
                    if (parts.length >= 2) {
                        english = parts[0];
                        chinese = parts.slice(1).join(' ');
                    }
                }
                
                if (english && chinese) {
                    // æ£€æŸ¥æ˜¯å¦é‡å¤
                    const exists = appState.userWords.some(w => 
                        w.english.toLowerCase() === english.toLowerCase());
                    
                    if (!exists) {
                        appState.userWords.push({
                            english: english,
                            chinese: chinese,
                            status: '',
                            reviewCount: 0,
                            addedDate: new Date().toISOString()
                        });
                        added++;
                    } else {
                        duplicates++;
                    }
                } else {
                    errors.push(trimmed);
                }
            }
            
            // ä¿å­˜æ•°æ®
            saveUserData();
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById('import-result');
            let resultHTML = `<h4>ğŸ“¥ å¯¼å…¥ç»“æœ</h4>`;
            resultHTML += `<p>âœ… æˆåŠŸæ·»åŠ : <strong>${added}</strong> ä¸ªæ–°å•è¯</p>`;
            
            if (duplicates > 0) {
                resultHTML += `<p>âš ï¸ è·³è¿‡é‡å¤: <strong>${duplicates}</strong> ä¸ªå•è¯</p>`;
            }
            
            if (errors.length > 0) {
                resultHTML += `<p>âŒ æ ¼å¼é”™è¯¯: <strong>${errors.length}</strong> è¡Œ</p>`;
            }
            
            resultHTML += `<p>ğŸ“Š å½“å‰å•è¯æ€»æ•°: <strong>${appState.userWords.length}</strong></p>`;
            
            if (added > 0) {
                resultHTML += `<p>ğŸ’¡ ç°åœ¨å¯ä»¥å¼€å§‹è®­ç»ƒäº†ï¼</p>`;
            }
            
            resultDiv.innerHTML = resultHTML;
            resultDiv.style.display = 'block';
            
            // æ›´æ–°ç»Ÿè®¡
            updateWordCount();
            
            // æ¸…ç©ºè¾“å…¥æ¡†ï¼ˆå¦‚æœæ·»åŠ æˆåŠŸï¼‰
            if (added > 0) {
                document.getElementById('word-input').value = '';
            }
        }
        
        function updateWordCount() {
            document.getElementById('total-words').textContent = appState.userWords.length;
            document.getElementById('new-words').textContent = appState.userWords.filter(w => !w.status).length;
        }
        
        // ========== å•è¯åº“ç®¡ç† ==========
        function showMyWords() {
            showScreen('words-screen');
        }
        
        function loadWordsList() {
            const container = document.getElementById('words-list-container');
            
            if (appState.userWords.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">ğŸ“š</div>
                        <h3 style="color: #666; margin-bottom: 15px;">è¿˜æ²¡æœ‰å•è¯</h3>
                        <p style="color: #999; margin-bottom: 25px;">å¿«å»æ·»åŠ ä¸€äº›å•è¯å¼€å§‹å­¦ä¹ å§ï¼</p>
                        <button class="btn btn-blue" onclick="showAddWords()">
                            <span>ğŸ“ å»æ·»åŠ å•è¯</span>
                        </button>
                    </div>
                `;
                return;
            }
            
            // åº”ç”¨ç­›é€‰
            const searchTerm = document.getElementById('word-search')?.value.toLowerCase() || '';
            const filterType = document.getElementById('word-filter')?.value || 'all';
            
            let filteredWords = appState.userWords.filter(word => {
                // æœç´¢ç­›é€‰
                const matchesSearch = word.english.toLowerCase().includes(searchTerm) || 
                                     word.chinese.toLowerCase().includes(searchTerm);
                
                // çŠ¶æ€ç­›é€‰
                let matchesFilter = true;
                switch(filterType) {
                    case 'remembered':
                        matchesFilter = word.status === 'remembered';
                        break;
                    case 'fuzzy':
                        matchesFilter = word.status === 'fuzzy';
                        break;
                    case 'forgot':
                        matchesFilter = word.status === 'forgot';
                        break;
                    case 'new':
                        matchesFilter = !word.status;
                        break;
                }
                
                return matchesSearch && matchesFilter;
            });
            
            // æ›´æ–°è®¡æ•°
            document.getElementById('filtered-count').textContent = filteredWords.length;
            
            // ç”Ÿæˆè¡¨æ ¼
            let html = `
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 25%;">è‹±æ–‡</th>
                                <th style="width: 25%;">ä¸­æ–‡</th>
                                <th style="width: 15%;">çŠ¶æ€</th>
                                <th style="width: 15%;">å¤ä¹ æ¬¡æ•°</th>
                                <th style="width: 20%;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            filteredWords.forEach((word, index) => {
                // è·å–çŠ¶æ€æ˜¾ç¤º
                let statusText, statusClass;
                switch(word.status) {
                    case 'remembered':
                        statusText = 'âœ… è®°å¾—';
                        statusClass = 'status-remembered';
                        break;
                    case 'fuzzy':
                        statusText = 'ğŸ”„ æ¨¡ç³Š';
                        statusClass = 'status-fuzzy';
                        break;
                    case 'forgot':
                        statusText = 'âŒ å¿˜è®°';
                        statusClass = 'status-forgot';
                        break;
                    default:
                        statusText = 'ğŸ“ æœªå­¦ä¹ ';
                        statusClass = 'status-forgot';
                }
                
                html += `
                    <tr>
                        <td><strong>${word.english}</strong></td>
                        <td>${word.chinese}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${word.reviewCount || 0}</td>
                        <td>
                            <button class="btn" style="padding: 6px 12px; font-size: 0.85em; margin: 2px;" 
                                    onclick="editWord(${index})">ç¼–è¾‘</button>
                            <button class="btn btn-red" style="padding: 6px 12px; font-size: 0.85em; margin: 2px;" 
                                    onclick="deleteWord(${index})">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }
        
        function filterWords() {
            loadWordsList();
        }
        
        function editWord(index) {
            const word = appState.userWords[index];
            const newEnglish = prompt('ä¿®æ”¹è‹±æ–‡å•è¯ï¼š', word.english);
            if (newEnglish && newEnglish.trim()) {
                const newChinese = prompt('ä¿®æ”¹ä¸­æ–‡æ„æ€ï¼š', word.chinese);
                if (newChinese && newChinese.trim()) {
                    word.english = newEnglish.trim();
                    word.chinese = newChinese.trim();
                    saveUserData();
                    loadWordsList();
                    showAlert('menu-feedback', 'âœ… å•è¯ä¿®æ”¹æˆåŠŸ', 'success');
                }
            }
        }
        
        function deleteWord(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•è¯å—ï¼Ÿ')) {
                appState.userWords.splice(index, 1);
                saveUserData();
                loadWordsList();
                showAlert('menu-feedback', 'ğŸ—‘ï¸ å•è¯åˆ é™¤æˆåŠŸ', 'success');
            }
        }
        
        function exportWords() {
            const exportText = appState.userWords.map(word => 
                `${word.english} ${word.chinese}`
            ).join('\n');
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `kathy_words_${appState.currentUser}_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('menu-feedback', 'ğŸ“¤ å•è¯å¯¼å‡ºæˆåŠŸ', 'success');
        }
        
        // ========== å¤ä¹ åŠŸèƒ½ ==========
        function showReviewWords() {
            // è·å–éœ€è¦å¤ä¹ çš„å•è¯ï¼ˆå¿˜è®°çš„æˆ–æ¨¡ç³Šçš„ï¼‰
            const reviewWords = appState.userWords.filter(word => 
                word.status === 'forgot' || word.status === 'fuzzy' || !word.status
            );
            
            if (reviewWords.length === 0) {
                alert('ğŸ‰ å¤ªæ£’äº†ï¼æ²¡æœ‰éœ€è¦å¤ä¹ çš„å•è¯ã€‚');
                return;
            }
            
            appState.trainingWords = reviewWords;
            appState.currentWordIndex = 0;
            appState.trainingMode = 'en_to_cn';
            appState.cardFlipped = false;
            appState.trainingStats = { remembered: 0, fuzzy: 0, forgot: 0 };
            
            showScreen('train-screen');
            showCurrentWord();
            
            showAlert('menu-feedback', `ğŸ“š å¼€å§‹å¤ä¹  ${reviewWords.length} ä¸ªå¼±é¡¹å•è¯`, 'success');
        }
        
        // ========== æ•™å¸ˆåŠŸèƒ½ ==========
        function showStudentStats() {
            alert('ğŸ‘‘ æ•™å¸ˆåŠŸèƒ½ï¼šæŸ¥çœ‹å­¦ç”Ÿå­¦ä¹ æƒ…å†µ\n\næ­¤åŠŸèƒ½éœ€è¦è¿æ¥æ•°æ®åº“ï¼Œå½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ã€‚');
        }
        
        function showAllStudents() {
            alert('ğŸ‘‘ æ•™å¸ˆåŠŸèƒ½ï¼šç®¡ç†å­¦ç”Ÿ\n\næ­¤åŠŸèƒ½éœ€è¦è¿æ¥æ•°æ®åº“ï¼Œå½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ã€‚');
        }
        
        // ========== è®¾ç½®åŠŸèƒ½ ==========
        function showSettings() {
            showScreen('settings-screen');
        }
        
        function saveSettings() {
            // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
            const settings = {
                autoFlip: document.getElementById('auto-flip').checked,
                soundEffects: document.getElementById('sound-effects').checked,
                dailyReminder: document.getElementById('daily-reminder').checked,
                wordsPerSession: document.getElementById('words-per-session').value
            };
            
            localStorage.setItem('word_trainer_settings', JSON.stringify(settings));
            showAlert('menu-feedback', 'âœ… è®¾ç½®å·²ä¿å­˜', 'success');
            setTimeout(() => showMenu(), 1000);
        }
        
        // ========== æ•°æ®æŒä¹…åŒ– ==========
        function saveUserData() {
            if (appState.currentUser && !appState.isTeacher) {
                localStorage.setItem(`user_words_${appState.currentUser}`, JSON.stringify(appState.userWords));
            }
        }
        
        function loadUserData() {
            if (appState.currentUser && !appState.isTeacher) {
                const savedData = localStorage.getItem(`user_words_${appState.currentUser}`);
                if (savedData) {
                    appState.userWords = JSON.parse(savedData);
                }
            }
        }
        
        // ========== é€€å‡ºç™»å½• ==========
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                appState.currentUser = null;
                appState.isTeacher = false;
                appState.userWords = [];
                localStorage.removeItem('word_trainer_user');
                document.getElementById('username').value = '';
                showLogin();
            }
        }
        
        // ========== åˆå§‹åŒ– ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Kathyå•è¯å¤§å¸ˆè®­ç»ƒè¥å¯åŠ¨');
            
            // å°è¯•åˆå§‹åŒ–Supabaseï¼ˆå¯é€‰ï¼‰
            try {
                supabase = window.supabase.createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);
                console.log('âœ… Supabaseè¿æ¥æˆåŠŸï¼ˆå¯é€‰ï¼‰');
            } catch (error) {
                console.log('â„¹ï¸ Supabaseè¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼');
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ç™»å½•ç”¨æˆ·
            const savedUser = localStorage.getItem('word_trainer_user');
            if (savedUser) {
                appState.currentUser = savedUser;
                appState.isTeacher = (savedUser === CONFIG.teacherUsername);
                
                if (!appState.isTeacher) {
                    loadUserData();
                }
                
                showMenu();
            }
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('username')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®ï¼ˆå¦‚æœç”¨æˆ·æ²¡æœ‰æ•°æ®ï¼‰
            if (appState.userWords.length === 0 && appState.currentUser && !appState.isTeacher) {
                // æ·»åŠ ä¸€äº›ç¤ºä¾‹å•è¯
                appState.userWords = [
                    { english: 'hello', chinese: 'ä½ å¥½', status: '', reviewCount: 0 },
                    { english: 'world', chinese: 'ä¸–ç•Œ', status: '', reviewCount: 0 },
                    { english: 'apple', chinese: 'è‹¹æœ', status: '', reviewCount: 0 }
                ];
                saveUserData();
            }
            
            // åŠ è½½è®¾ç½®
            const savedSettings = localStorage.getItem('word_trainer_settings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('auto-flip').checked = settings.autoFlip;
                document.getElementById('sound-effects').checked = settings.soundEffects;
                document.getElementById('daily-reminder').checked = settings.dailyReminder;
                document.getElementById('words-per-session').value = settings.wordsPerSession;
            }
        });
    </script>
</body>
</html>
